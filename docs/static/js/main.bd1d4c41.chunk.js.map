{"version":3,"sources":["components/AppHeader.js","lib/Random.js","lib/Puyo.js","components/Game.js","components/App.js","index.js"],"names":["AppHeader","react_default","a","createElement","className","Random","seed","Object","classCallCheck","this","y","Math","random","max","abs","next","Kind","BRANK","RED","GREEN","BLUE","YELLOW","PURPLE","IRON","OJAMA","WALL","PEKE","isNull","obj","PuyoPair","axis","sub","Next","mode","init","_mode","nextInt","_seed","_random","_size","_puyos","i","push","_nextKind","num","Error","turn","kind","isAxis","Pos","x","isNaN","Field","height","width","_field","line","pos","get","flag","t","p","set","isBrank","flags","_countConnection","_deleteConnection","step","Step","connections","color","colorFlags","n","deleteConnection","keys","length","fd","field","transform","array","Puyo","Game","props","_this","possibleConstructorReturn","getPrototypeOf","call","state","field1","field2","console","log","fieldToElements","_this2","map","style","left","top","kindToClassName","key","concat","React","Component","App","src_components_AppHeader","Game_Game","render","src_components_App","document","getElementById"],"mappings":"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","file":"static/js/main.bd1d4c41.chunk.js","sourcesContent":["import React from 'react'\nimport './AppHeader.css';\n\nconst AppHeader = () => (\n  <div className='AppHeader'>\n    <div className='AppHeader-title'>ぷよたんβ</div>\n    <div className='AppHeader-version'>v0.1</div>\n  </div>\n)\n\nexport default AppHeader;\n","class Random {\r\n  constructor (seed) {\r\n    if (seed == null) {\r\n      this.y = Math.random() * 2147483647\r\n    } else {\r\n      this.y = seed\r\n    }\r\n  }\r\n  setSeed (seed) {\r\n    this.y = seed\r\n  }\r\n  next () {\r\n    this.y = this.y ^ (this.y << 13)\r\n    this.y = this.y ^ (this.y >> 17)\r\n    this.y = this.y ^ (this.y << 15)\r\n    return this.y >>> 0\r\n  }\r\n  nextInt (max) { // 0 ~ max未満のランダムな整数を返す\r\n    const r = Math.abs(this.next())\r\n    return r % max\r\n  }\r\n}\r\n\r\nexport default Random\r\n","import Random from './Random'\r\n\r\n/** ぷよの種類用列挙型 */\r\nconst Kind = {\r\n  BRANK: 0,\r\n  RED: 1,\r\n  GREEN: 2,\r\n  BLUE: 3,\r\n  YELLOW: 4,\r\n  PURPLE: 5,\r\n  IRON: 6,\r\n  OJAMA: 7,\r\n  WALL: 8,\r\n  PEKE: 9\r\n}\r\n\r\n// 補助関数\r\nfunction isNull(obj) {\r\n  return obj == null\r\n}\r\n\r\n//------------------------------------------ クラス定義\r\n/** ぷよの組 */\r\nclass PuyoPair {\r\n  constructor(axis, sub) {\r\n    this.axis = isNull(axis) ? Kind.BRANK : axis\r\n    this.sub = isNull(sub) ? Kind.BRANK : sub\r\n  }\r\n}\r\n\r\n/**\r\n * seed を元に PuyoPair を生成するクラス\r\n * mode は現在 random のみ対応…\r\n */\r\nclass Next {\r\n  constructor(seed, mode) {\r\n    this.init(seed, mode)\r\n  }\r\n  init(seed, mode) {\r\n    if (mode == null) mode = 'random'\r\n    this._mode = mode\r\n    if (seed == null) {\r\n      let r = new Random()\r\n      seed = r.nextInt(64 * 64 * 64 * 64)\r\n    }\r\n    this._seed = seed\r\n    this._random = new Random(this._seed)\r\n    this._size = 1000\r\n    this._puyos = []\r\n    for (let i = 0; i < this._size; i++) {\r\n      this._puyos.push(new PuyoPair(this._nextKind(), this._nextKind()))\r\n    }\r\n  }\r\n  size() {\r\n    return this._size\r\n  }\r\n  get(num) {\r\n    return this._puyos[num % 1024]\r\n  }\r\n  _nextKind() {\r\n    switch (this._random.nextInt(4)) {\r\n      case 0: return Kind.RED\r\n      case 1: return Kind.GREEN\r\n      case 2: return Kind.BLUE\r\n      case 3: return Kind.YELLOW\r\n      default: throw new Error(\"unexpected error\")\r\n    }\r\n  }\r\n  seed() {\r\n    return this._seed\r\n  }\r\n  edit(turn, kind, isAxis) {\r\n    if (turn >= this._size || turn < 0) return\r\n    if (isAxis) {\r\n      this._puyos[turn].axis = kind\r\n    } else {\r\n      this._puyos[turn].sub = kind\r\n    }\r\n  }\r\n}\r\n\r\n/** ぷよの設置位置 */\r\nclass Pos {\r\n  constructor(x, y) {\r\n    this.x = isNaN(x) ? 0 : x\r\n    this.y = isNaN(y) ? 0 : y\r\n  }\r\n}\r\n\r\n/**\r\n * ぷよフィールド\r\n * 6*13のグリッド内に常にぷよが収まる事を想定\r\n * 14段目も考慮する\r\n * fall()後に存在する14段目ぷよは全て消える（通のように残ったりしない）\r\n */\r\nclass Field {\r\n  constructor() {\r\n    this.height = 13\r\n    this.width = 6\r\n    this._field = []\r\n    for (let y = 0; y < this.height + 1; y++) {\r\n      let line = []\r\n      for (let x = 0; x < this.width; x++) {\r\n        line.push(Kind.BRANK)\r\n      }\r\n      this._field.push(line)\r\n    }\r\n  }\r\n  isBrank(pos) {\r\n    return this.get(pos) === Kind.BRANK\r\n  }\r\n  get(pos) {\r\n    if (pos.y < 1 || pos.x < 1 || pos.x > this.width) {\r\n      return Kind.WALL\r\n    }\r\n    if (pos.y > this.height) {\r\n      return Kind.BRANK\r\n    }\r\n    return this._field[pos.y - 1][pos.x - 1]\r\n  }\r\n  set(pos, kind) {\r\n    if (pos.y < 1 || pos.y > this.height + 1 || pos.x < 1 || pos.x > this.width) {\r\n      return\r\n    }\r\n    this._field[pos.y - 1][pos.x - 1] = kind\r\n  }\r\n  fall() {\r\n    let flag = false // 落下が発生したかどうか\r\n    for (let x = 1; x <= this.width; x++) {\r\n      let t = 1\r\n      for (let y = 1; y <= this.height; y++) {\r\n        let p = this.get(new Pos(x, y))\r\n        if (p === Kind.BRANK) continue\r\n        if (p === Kind.WALL) {\r\n          t = y + 1\r\n          continue\r\n        }\r\n        this.set(new Pos(x, y), this.get(new Pos(x, t)))\r\n        this.set(new Pos(x, t), p)\r\n        if (t !== y) flag = true\r\n        t++\r\n      }\r\n    }\r\n    for (let x = 1; x <= this.width; x++) this.set(new Pos(x, 14), Kind.BRANK)\r\n    return flag\r\n  }\r\n  canFall() {\r\n    for (let x = 1; x <= this.width; x++) {\r\n      for (let y = 2; y <= this.height; y++) {\r\n        if (this.isBrank(new Pos(x, y - 1)) && !this.isBrank(new Pos(x, y)) && this.get(new Pos(x, y)) !== Kind.WALL) return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n  _countConnection(pos, kind, flags) {\r\n    if (this.get(pos) === Kind.IRON) return 0\r\n    if (this.get(pos) === Kind.PEKE) return 0\r\n    if (this.get(pos) === Kind.WALL) return 0\r\n    if (this.get(pos) === Kind.BRANK) return 0\r\n    if (this.get(pos) === Kind.OJAMA) return 0\r\n    if (this.get(pos) !== kind) return 0\r\n    if (flags.get(pos) !== Kind.BRANK) return 0\r\n    if (pos.y >= 13) return 0\r\n    flags.set(pos, kind)\r\n    return this._countConnection(new Pos(pos.x, pos.y + 1), kind, flags) +\r\n      this._countConnection(new Pos(pos.x + 1, pos.y), kind, flags) +\r\n      this._countConnection(new Pos(pos.x, pos.y - 1), kind, flags) +\r\n      this._countConnection(new Pos(pos.x - 1, pos.y), kind, flags) + 1\r\n  }\r\n  countConnection(pos) {\r\n    return this._countConnection(pos, this.get(pos), new Field())\r\n  }\r\n  _deleteConnection(pos, kind) {\r\n    if (this.get(pos) === Kind.BRANK) return 0\r\n    if (this.get(pos) === Kind.OJAMA) {\r\n      this.set(pos, Kind.BRANK)\r\n      return 0\r\n    }\r\n    if (this.get(pos) !== kind) return 0\r\n    if (pos.y >= 13) return 0\r\n    this.set(pos, Kind.BRANK)\r\n    return this._deleteConnection(new Pos(pos.x, pos.y + 1), kind) +\r\n      this._deleteConnection(new Pos(pos.x + 1, pos.y), kind) +\r\n      this._deleteConnection(new Pos(pos.x, pos.y - 1), kind) +\r\n      this._deleteConnection(new Pos(pos.x - 1, pos.y), kind) + 1\r\n  }\r\n  deleteConnection(pos) {\r\n    return this._deleteConnection(pos, this.get(pos))\r\n  }\r\n  canFire() {\r\n    let flags = new Field()\r\n    for (let y = 1; y < this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        if (this._countConnection(pos, this.get(pos), flags) >= 4) return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n  stepFire() {\r\n    class Step {\r\n      constructor() {\r\n        this.num = 0          // 消えたぷよの数\r\n        this.connections = [] // 連結数\r\n        this.color = 0        // 色数\r\n      }\r\n    }\r\n    let step = new Step()\r\n    let flags = new Field()\r\n    var colorFlags = {}\r\n    for (let y = 1; y < this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        let kind = this.get(pos)\r\n        let n = this._countConnection(pos, kind, flags)\r\n        if (n >= 4) {\r\n          this.deleteConnection(pos)\r\n          step.num += n\r\n          step.connections.push(n)\r\n          colorFlags[kind] = true\r\n        }\r\n      }\r\n    }\r\n    step.color = Object.keys(colorFlags).length\r\n    return step\r\n  }\r\n  Height() {\r\n    return this.height\r\n  }\r\n  Width() {\r\n    return this.width\r\n  }\r\n  copy() {\r\n    let fd = new Field()\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        fd.set(pos, this.get(pos))\r\n      }\r\n    }\r\n    return fd\r\n  }\r\n  equal(field) {\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        if (this.get(pos) !== field.get(pos)) return false\r\n      }\r\n    }\r\n    return true\r\n  }\r\n  isAllClear() {\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        if (this.get(pos) !== Kind.BRANK) return false\r\n      }\r\n    }\r\n    return true\r\n  }\r\n  map(transform) {\r\n    let array = [];\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        let kind = this.get(pos)\r\n        array.push(transform(pos, kind));\r\n      }\r\n    }\r\n    return array;\r\n  }\r\n}\r\n\r\nexport default {\r\n  Kind: Kind,\r\n  Pos: Pos,\r\n  Next: Next,\r\n  Field: Field\r\n}\r\n","import React from \"react\";\nimport './Game.css';\nimport Puyo from '../lib/Puyo.js';\nimport Puyotan from '../lib/Puyotan.js';\n\nexport default class Game extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      next: new Puyo.Next(),\n      field1: new Puyo.Field(),\n      field2: new Puyo.Field()\n    };\n    // this.cnt = 0;\n    // setInterval(() => {\n    //   const field = this.state.field1.copy();\n    //   const ppair = this.state.next.get(this.cnt);\n    //   this.cnt++;\n    //   field.set(new Puyo.Pos(1, 2), ppair.axis);\n    //   field.set(new Puyo.Pos(2, 2), ppair.sub);\n    //   field.set(new Puyo.Pos(3, 2), Puyo.Kind.BLUE);\n    //   console.log(field)\n    //   this.setState({\n    //     field1: field\n    //   })\n    // }, 1000)\n  }\n\n  render() {\n    console.log(this.state.field1)\n    return (\n      <div className=\"Game\">\n        <div className=\"Game-field Game-pos-field1\">\n          {this.fieldToElements(this.state.field1)}\n        </div>\n        <div className=\"Game-field Game-pos-field2\">\n          {this.fieldToElements(this.state.field2)}\n        </div>\n      </div>\n    );\n  }\n\n  fieldToElements(field) {\n    return field.map((pos, kind) => {\n      const style = {\n        left: (pos.x - 1) * 32,\n        top: (13 - pos.y) * 32,\n      }\n      const className = this.kindToClassName(kind);\n      return <div key={`${pos.x}_${pos.y}`} style={style} className={`Game-puyo ${className}`}></div>;\n    })\n  }\n\n  kindToClassName(kind) {\n    switch(kind) {\n      case Puyo.Kind.RED: return \"Game-puyo-kind-red\"\n      case Puyo.Kind.BLUE: return \"Game-puyo-kind-blue\"\n      case Puyo.Kind.GREEN: return \"Game-puyo-kind-green\"\n      case Puyo.Kind.YELLOW: return \"Game-puyo-kind-yellow\"\n      case Puyo.Kind.OJAMA: return \"Game-puyo-kind-ojama\"\n      default: return \"Game-puyo-kind-blank\"\n    }\n  }\n\n  // submit = (e) => {\n  //   this.onButtonClick({\n  //     name: this.state.name,\n  //     text: this.state.text\n  //   });\n  //   this.setState({\n  //     text: \"\"\n  //   });\n  // }\n}","import React from 'react'\nimport './App.css';\nimport AppHeader from './AppHeader'\nimport Game from './Game'\n\nconst App = () => (\n  <div className='App'>\n    <AppHeader />\n    <Game />\n  </div>\n)\n\nexport default App;\n","import React from 'react';\nimport { render } from 'react-dom';\nimport App from './components/App';\nimport './index.css';\n\nrender(\n  <App />,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}