{"version":3,"sources":["components/AppHeader.js","lib/Random.js","lib/Puyo.js","lib/Puyotan.js","components/Game.js","components/App.js","index.js"],"names":["AppHeader","react_default","a","createElement","className","Random","seed","Object","classCallCheck","this","y","Math","random","max","abs","next","Kind","BRANK","RED","GREEN","BLUE","YELLOW","PURPLE","IRON","OJAMA","WALL","PEKE","PuyoPair","axis","arguments","length","undefined","sub","Next","mode","init","_mode","nextInt","_seed","_random","_size","_puyos","i","push","_nextKind","num","turn","kind","isAxis","Error","Pos","x","isNaN","Field","height","width","_field","line","pos","get","RangeError","isBrank","set","fall","flag","t","p","flags","_countConnection","_deleteConnection","step","Step","connections","color","colorFlags","n","deleteConnection","keys","fd","field","transform","array","copy","reverse","map","join","Puyo","ActionType","PASS","PUT","CHAIN","Action","type","dir","ActionHistory","action","remainingFrame","Player","actionHistories","activeNextPos","score","usedScore","nonActiveOjama","activeOjama","chain","setAndFall","memo","cnt","j","lib_Puyotan","Puyotan","players","frame","gameStatusText","id","_this","every","_this2","canStepNextFrame","console","error","forEach","currentHistory","tumo","concat","canFire","info","stepFire","calcScore","ojama","floor","usedNum","min","sendOjama","fallOjamaNum","fallOjama","aliveCount","alivePlayerId","nextHistory","C","base","rate","senderId","_this3","activePair","next1","next2","Game","props","possibleConstructorReturn","getPrototypeOf","call","puyotan","vm","getViewModel","state","activePair1","activePair2","field1","field2","next11","next12","next21","next22","actionHistories1","actionHistories2","controledPos1","controledDir1","controledPos2","controledDir2","isControlledPlayer1","isControlledPlayer2","chain1","chain2","score1","score2","usedScore1","usedScore2","nonActiveOjama1","nonActiveOjama2","activeOjama1","activeOjama2","window","addEventListener","e","preventDefault","keyCode","moveLeft","moveRight","putPuyo","toggleControlledPlayer1","toggleControlledPlayer2","turnRight","turnLeft","stepNextFrame","pass","gameStart","assertThisInitialized","put","setAction","actionHistoriesToElements","fieldToElements","style","top","getSubPos1","left","kindToClassName","getAxisPos1","getSubPos2","getAxisPos2","nextToElements","index","history","text","key","pair","setState","start","reflectPuyotanView","adjust","React","Component","App","src_components_AppHeader","Game_Game","render","src_components_App","document","getElementById"],"mappings":"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","file":"static/js/main.8d15a245.chunk.js","sourcesContent":["import React from 'react'\nimport './AppHeader.css';\n\nconst AppHeader = () => (\n  <div className='AppHeader'>\n    <div className='AppHeader-title'>ぷよたんβ</div>\n    <div className='AppHeader-version'>v0.1</div>\n  </div>\n)\n\nexport default AppHeader;\n","class Random {\r\n  constructor (seed) {\r\n    if (seed == null) {\r\n      this.y = Math.random() * 2147483647\r\n    } else {\r\n      this.y = seed\r\n    }\r\n  }\r\n  setSeed (seed) {\r\n    this.y = seed\r\n  }\r\n  next () {\r\n    this.y = this.y ^ (this.y << 13)\r\n    this.y = this.y ^ (this.y >> 17)\r\n    this.y = this.y ^ (this.y << 15)\r\n    return this.y >>> 0\r\n  }\r\n  nextInt (max) { // 0 ~ max未満のランダムな整数を返す\r\n    const r = Math.abs(this.next())\r\n    return r % max\r\n  }\r\n}\r\n\r\nexport default Random\r\n","import Random from './Random'\r\n\r\n/** ぷよの種類用列挙型 */\r\nconst Kind = {\r\n  BRANK: 0,\r\n  RED: 1,\r\n  GREEN: 2,\r\n  BLUE: 3,\r\n  YELLOW: 4,\r\n  PURPLE: 5,\r\n  IRON: 6,\r\n  OJAMA: 7,\r\n  WALL: 8,\r\n  PEKE: 9\r\n}\r\n\r\n//------------------------------------------ クラス定義\r\n/** ぷよの組 */\r\nclass PuyoPair {\r\n  constructor(axis = Kind.BRANK, sub = Kind.BRANK) {\r\n    this.axis = axis\r\n    this.sub = sub\r\n  }\r\n}\r\n\r\n/**\r\n * seed を元に PuyoPair を生成するクラス\r\n * mode は現在 random のみ対応…\r\n */\r\nclass Next {\r\n  constructor(seed, mode) {\r\n    this.init(seed, mode)\r\n  }\r\n  init(seed, mode) {\r\n    if (mode == null) mode = 'random'\r\n    this._mode = mode\r\n    if (seed == null) {\r\n      let r = new Random()\r\n      seed = r.nextInt(64 * 64 * 64 * 64)\r\n    }\r\n    this._seed = seed\r\n    this._random = new Random(this._seed)\r\n    this._size = 1000\r\n    this._puyos = []\r\n    for (let i = 0; i < this._size; i++) {\r\n      this._puyos.push(new PuyoPair(this._nextKind(), this._nextKind()))\r\n    }\r\n  }\r\n  size() {\r\n    return this._size\r\n  }\r\n  get(num) {\r\n    return this._puyos[num % this._size]\r\n  }\r\n  seed() {\r\n    return this._seed\r\n  }\r\n  edit(turn, kind, isAxis) {\r\n    if (turn >= this._size || turn < 0) return\r\n    if (isAxis) {\r\n      this._puyos[turn].axis = kind\r\n    } else {\r\n      this._puyos[turn].sub = kind\r\n    }\r\n  }\r\n  _nextKind() {\r\n    switch (this._random.nextInt(4)) {\r\n      case 0: return Kind.RED\r\n      case 1: return Kind.GREEN\r\n      case 2: return Kind.BLUE\r\n      case 3: return Kind.YELLOW\r\n      default: throw new Error(\"unexpected error\")\r\n    }\r\n  }\r\n}\r\n\r\n/** ぷよの設置位置 */\r\nclass Pos {\r\n  constructor(x, y) {\r\n    this.x = isNaN(x) ? 0 : x\r\n    this.y = isNaN(y) ? 0 : y\r\n  }\r\n}\r\n\r\n/**\r\n * ぷよフィールド\r\n * 6*13のグリッド内に常にぷよが収まる事を想定\r\n * 14段目も考慮する\r\n * fall()後に存在する14段目ぷよは全て消える（通のように残ったりしない）\r\n */\r\nclass Field {\r\n  constructor() {\r\n    this.height = 13\r\n    this.width = 6\r\n    this._field = []\r\n    for (let y = 0; y < this.height + 1; y++) {\r\n      let line = []\r\n      for (let x = 0; x < this.width; x++) {\r\n        line.push(Kind.BRANK)\r\n      }\r\n      this._field.push(line)\r\n    }\r\n  }\r\n  isBrank(pos) {\r\n    return this.get(pos) === Kind.BRANK\r\n  }\r\n  get(pos) {\r\n    if (pos.y < 1 || pos.x < 1 || pos.x > this.width) {\r\n      return Kind.WALL\r\n    }\r\n    if (pos.y > this.height) {\r\n      return Kind.BRANK\r\n    }\r\n    return this._field[pos.y - 1][pos.x - 1]\r\n  }\r\n  set(pos, kind) {\r\n    if (pos.y < 1 || pos.y > this.height + 1 || pos.x < 1 || pos.x > this.width) {\r\n      return\r\n    }\r\n    this._field[pos.y - 1][pos.x - 1] = kind\r\n  }\r\n  setAndFall(x, kind) {\r\n    if (x < 1 || x > this.width) throw RangeError('out of field.');\r\n    if (this.isBrank(new Pos(x, 13))) {\r\n      this.set(new Pos(x, 13), kind);\r\n      this.fall();\r\n    }\r\n  }\r\n  fall() {\r\n    let flag = false // 落下が発生したかどうか\r\n    for (let x = 1; x <= this.width; x++) {\r\n      let t = 1\r\n      for (let y = 1; y <= (this.height + 1); y++) {\r\n        let p = this.get(new Pos(x, y))\r\n        if (p === Kind.BRANK) continue\r\n        if (p === Kind.WALL) {\r\n          t = y + 1\r\n          continue\r\n        }\r\n        this.set(new Pos(x, y), this.get(new Pos(x, t)))\r\n        this.set(new Pos(x, t), p)\r\n        if (t !== y) flag = true\r\n        t++\r\n      }\r\n    }\r\n    for (let x = 1; x <= this.width; x++) this.set(new Pos(x, 14), Kind.BRANK)\r\n    return flag\r\n  }\r\n  canFall() {\r\n    for (let x = 1; x <= this.width; x++) {\r\n      for (let y = 2; y <= this.height; y++) {\r\n        if (this.isBrank(new Pos(x, y - 1)) && !this.isBrank(new Pos(x, y)) && this.get(new Pos(x, y)) !== Kind.WALL) return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n  _countConnection(pos, kind, flags) {\r\n    if (this.get(pos) === Kind.IRON) return 0\r\n    if (this.get(pos) === Kind.PEKE) return 0\r\n    if (this.get(pos) === Kind.WALL) return 0\r\n    if (this.get(pos) === Kind.BRANK) return 0\r\n    if (this.get(pos) === Kind.OJAMA) return 0\r\n    if (this.get(pos) !== kind) return 0\r\n    if (flags.get(pos) !== Kind.BRANK) return 0\r\n    if (pos.y >= 13) return 0\r\n    flags.set(pos, kind)\r\n    return this._countConnection(new Pos(pos.x, pos.y + 1), kind, flags) +\r\n      this._countConnection(new Pos(pos.x + 1, pos.y), kind, flags) +\r\n      this._countConnection(new Pos(pos.x, pos.y - 1), kind, flags) +\r\n      this._countConnection(new Pos(pos.x - 1, pos.y), kind, flags) + 1\r\n  }\r\n  countConnection(pos) {\r\n    return this._countConnection(pos, this.get(pos), new Field())\r\n  }\r\n  _deleteConnection(pos, kind) {\r\n    if (this.get(pos) === Kind.BRANK) return 0\r\n    if (this.get(pos) === Kind.OJAMA) {\r\n      this.set(pos, Kind.BRANK)\r\n      return 0\r\n    }\r\n    if (this.get(pos) !== kind) return 0\r\n    if (pos.y >= 13) return 0\r\n    this.set(pos, Kind.BRANK)\r\n    return this._deleteConnection(new Pos(pos.x, pos.y + 1), kind) +\r\n      this._deleteConnection(new Pos(pos.x + 1, pos.y), kind) +\r\n      this._deleteConnection(new Pos(pos.x, pos.y - 1), kind) +\r\n      this._deleteConnection(new Pos(pos.x - 1, pos.y), kind) + 1\r\n  }\r\n  deleteConnection(pos) {\r\n    return this._deleteConnection(pos, this.get(pos))\r\n  }\r\n  canFire() {\r\n    let flags = new Field()\r\n    for (let y = 1; y < this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        if (this._countConnection(pos, this.get(pos), flags) >= 4) return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n  stepFire() {\r\n    class Step {\r\n      constructor() {\r\n        this.num = 0          // 消えたぷよの数\r\n        this.connections = [] // 連結数\r\n        this.color = 0        // 色数\r\n      }\r\n    }\r\n    let step = new Step()\r\n    let flags = new Field()\r\n    var colorFlags = {}\r\n    for (let y = 1; y < this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        let kind = this.get(pos)\r\n        let n = this._countConnection(pos, kind, flags)\r\n        if (n >= 4) {\r\n          this.deleteConnection(pos)\r\n          step.num += n\r\n          step.connections.push(n)\r\n          colorFlags[kind] = true\r\n        }\r\n      }\r\n    }\r\n    step.color = Object.keys(colorFlags).length\r\n    return step\r\n  }\r\n  Height() {\r\n    return this.height\r\n  }\r\n  Width() {\r\n    return this.width\r\n  }\r\n  copy() {\r\n    let fd = new Field()\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        fd.set(pos, this.get(pos))\r\n      }\r\n    }\r\n    return fd\r\n  }\r\n  equal(field) {\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        if (this.get(pos) !== field.get(pos)) return false\r\n      }\r\n    }\r\n    return true\r\n  }\r\n  isAllClear() {\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        if (this.get(pos) !== Kind.BRANK) return false\r\n      }\r\n    }\r\n    return true\r\n  }\r\n  map(transform) {\r\n    let array = [];\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        let kind = this.get(pos)\r\n        array.push(transform(pos, kind));\r\n      }\r\n    }\r\n    return array;\r\n  }\r\n  toString() {\r\n    let field = this.copy()._field;\r\n    field.reverse();\r\n    return field.map(line => line.join(',')).join('\\n');\r\n  }\r\n}\r\n\r\nexport default {\r\n  Kind: Kind,\r\n  Pos: Pos,\r\n  Next: Next,\r\n  Field: Field,\r\n  PuyoPair: PuyoPair,\r\n}\r\n","import Puyo from './Puyo'\nimport Random from './Random'\n\n/** アクション用列挙型 TODO: v2ではクラス階層で表現する */\nconst ActionType = {\n  PASS: 0,\n  PUT: 1,\n  CHAIN: 2,\n  OJAMA: 3\n}\n\nclass Action {\n  constructor(type = ActionType.PASS, x = 0, dir = 0) {\n    this.type = type;\n    this.x = x;\n    this.dir = dir;\n  }\n}\n\nclass ActionHistory {\n  constructor(action, remainingFrame = 0) {\n    this.action = action;\n    this.remainingFrame = remainingFrame;\n  }\n}\n\nclass Player {\n  constructor() {\n    this.field = new Puyo.Field();\n    this.actionHistories = [];\n    this.activeNextPos = 0;\n    this.score = 0;\n    this.usedScore = 0;\n    this.nonActiveOjama = 0;\n    this.activeOjama = 0;\n    this.chain = 0;\n    // 乱数生成器\n    this.random = new Random();\n  }\n\n  fallOjama(num) {\n    while (num > 0) {\n      if (num >= 6) {\n        for (let x = 1; x <= 6; x++) this.field.setAndFall(x, Puyo.Kind.OJAMA);\n        num -= 6;\n      } else {\n        let memo = [false, false, false, false, false, false];\n        for (let i = 0; i < num; i++) {\n          let pos = this.random.nextInt(6 - i);\n          let cnt = 0;\n          for (let j = 0; j < 6; j++) {\n            if (!memo[j]) {\n              if (cnt++ === pos) memo[j] = true;\n            }\n          }\n        }\n        for (let x = 1; x <= 6; x++) {\n          if (memo[x - 1]) this.field.setAndFall(x, Puyo.Kind.OJAMA);\n        }\n        num = 0;\n      }\n    }\n  }\n}\n\nclass Puyotan {\n  constructor() {\n    this.next = new Puyo.Next();\n    this.players = [\n      new Player(),\n      new Player()\n    ];\n    this.frame = 0;\n    this.gameStatusText = \"待機中\";\n  }\n\n  getPlayer(id) {\n    return this.players[id];\n  }\n\n  start() {\n    if (this.frame === 0) {\n      this.frame++;\n      this.gameStatusText = \"対戦中\";\n    }\n  }\n\n  setAction(id, action) {\n    if (this.frame <= 0) return;\n    let history = this.players[id].actionHistories[this.frame];\n    if (history == null) {\n      switch (action.type) {\n        case ActionType.PASS:\n          this.players[id].actionHistories[this.frame] = new ActionHistory(action, 0);\n          break;\n        case ActionType.PUT:\n          this.players[id].actionHistories[this.frame] = new ActionHistory(action, 1);\n          break;\n        default:\n          throw new Error('unsupported action type.');\n      }\n    }\n  }\n\n  canStepNextFrame() {\n    if (this.frame <= 0) return false;\n    return this.players.every(p => p.actionHistories[this.frame] != null);\n  }\n\n  stepNextFrame() {\n    // 2. 行動選択・予約\n    // パス・設置から選択（※硬直中は選択は無効化される）（全プレイヤーが選択するまで待つ）\n    // 設置なら行動予約する（硬直２）\n    if (!this.canStepNextFrame()) {\n      return console.error(`can not step next frame.`);\n    }\n    this.players.forEach((p, id) => {\n      let currentHistory = p.actionHistories[this.frame];\n      if (currentHistory.remainingFrame > 0) {\n        p.actionHistories[this.frame + 1] = new ActionHistory(currentHistory.action, currentHistory.remainingFrame - 1);\n      }\n    });\n    // 3. 行動実行\n    // 硬直カウント減算して０になったら予約された行動を実行\n    // 設置：フィールドに設置、消せるぷよがあれば連鎖を行動予約（硬直３）\n    // 連鎖：ぷよを消去し得点を増加、相殺を処理（非アクティブを優先）し、落下し消せるぷよがあれば連鎖を行動予約（硬直３）、なければ送ったおじゃまをアクティブに\n    // おじゃま：アクティブなおじゃまから最大５段分設置\n    this.players.forEach((p, id) => {\n      const currentHistory = p.actionHistories[this.frame];\n      if (currentHistory.remainingFrame === 0) {\n        switch (currentHistory.action.type) {\n          case ActionType.PASS:\n            break;\n          case ActionType.PUT:\n            let tumo = this.next.get(p.activeNextPos);\n            const x = currentHistory.action.x;\n            const dir = currentHistory.action.dir;\n            switch (dir) {\n              case 0:\n                p.field.setAndFall(x, tumo.axis);\n                p.field.setAndFall(x, tumo.sub);\n                break;\n              case 1:\n                p.field.setAndFall(x, tumo.axis);\n                p.field.setAndFall(x + 1, tumo.sub);\n                break;\n              case 2:\n                p.field.setAndFall(x, tumo.sub);\n                p.field.setAndFall(x, tumo.axis);\n                break;\n              case 3:\n                p.field.setAndFall(x, tumo.axis);\n                p.field.setAndFall(x - 1, tumo.sub);\n                break;\n              default:\n                throw Error(`unsupported direction range or type. ${dir}`);\n            }\n            if (p.field.canFire()) {\n              p.chain = 0;\n              p.actionHistories[this.frame + 1] = new ActionHistory(new Action(ActionType.CHAIN), 2);\n            }\n            break;\n          case ActionType.CHAIN:\n            let info = p.field.stepFire();\n            p.chain++;\n            p.score += this.calcScore(info.num, info.color, info.connections, p.chain);\n            let ojama = Math.floor((p.score - p.usedScore) / 70);\n            p.usedScore += ojama * 70;\n            if (p.nonActiveOjama > 0) {\n              let usedNum = Math.min(ojama, p.nonActiveOjama);\n              p.nonActiveOjama -= usedNum;\n              ojama -= usedNum;\n            }\n            if (p.activeOjama > 0) {\n              let usedNum = Math.min(ojama, p.activeOjama);\n              p.activeOjama -= usedNum;\n              ojama -= usedNum;\n            }\n            if (ojama > 0) {\n              this.sendOjama(id, ojama);\n            }\n            p.field.fall();\n            if (p.field.canFire()) {\n              p.actionHistories[this.frame + 1] = new ActionHistory(new Action(ActionType.CHAIN), 2);\n            } else {\n              this.activeOjama(id);\n            }\n            break;\n          case ActionType.OJAMA:\n            if (p.activeOjama <= 0) throw new Error('failed to fall ojama.');\n            let fallOjamaNum = Math.min(p.activeOjama, 30);\n            p.activeOjama -= fallOjamaNum;\n            p.fallOjama(fallOjamaNum);\n            break;\n          default:\n            throw new Error('unsupported action type.');\n        }\n      }\n    });\n    // 4. 窒息判定\n    // 勝敗がついていれば終了\n    let aliveCount = 0;\n    let alivePlayerId = 0;\n    this.players.forEach((p, id) => {\n      if (p.actionHistories[this.frame + 1] == null && p.field.get(new Puyo.Pos(3, 12)) !== Puyo.Kind.BRANK) {\n      } else {\n        aliveCount++;\n        alivePlayerId = id;\n      }\n    });\n    if (aliveCount === 0) {\n      this.gameStatusText = `引き分け…`;\n    }\n    if (aliveCount === 1) {\n      this.gameStatusText = `Player ${alivePlayerId + 1} の勝利！`;\n    }\n    // 5. おじゃま処理\n    // 次フレームが操作可能でアクティブなおじゃまがあったらおじゃまを行動予約（硬直１）\n    this.players.forEach((p, id) => {\n      if (p.actionHistories[this.frame + 1] == null && p.activeOjama > 0) {\n        p.actionHistories[this.frame + 1] = new ActionHistory(new Action(ActionType.OJAMA), 0);\n      }\n    });\n    // 0. フレーム遷移\n    // 今回フレームがパス以外で硬直状態でなければツモを進める\n    this.players.forEach((p, id) => {\n      const currentHistory = p.actionHistories[this.frame];\n      const nextHistory = p.actionHistories[this.frame + 1];\n      if (currentHistory.action.type !== ActionType.PASS && nextHistory == null) {\n        p.activeNextPos++;\n      }\n    });\n    this.frame++;\n  }\n\n  calcScore(num, color, connections, chain) {\n    const A = [0, 8, 16, 32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, 480, 512]\n    const B = [0, 3, 6, 12, 24]\n    const C = [0, 2, 3, 4, 5, 6, 7, 10]\n    let base = num * 10\n    let rate = A[chain - 1]\n    if (rate === undefined) rate = 512\n    rate += B[color - 1]\n    for (let i = 0; i < connections.length; i++) {\n      let n = connections[i]\n      if (n > 11) rate += 10\n      else rate += C[n - 4]\n    }\n    if (rate === 0) rate = 1\n    return base * rate\n  }\n\n  sendOjama(senderId, ojama) {\n    this.players.forEach((p, id) => {\n      if (id !== senderId) {\n        p.nonActiveOjama += ojama;\n      }\n    });\n  }\n\n  activeOjama(senderId) {\n    this.players.forEach((p, id) => {\n      if (id !== senderId) {\n        p.activeOjama += p.nonActiveOjama;\n        p.nonActiveOjama = 0;\n      }\n    });\n  }\n\n  getViewModel() {\n    return {\n      frame: this.frame,\n      players: this.players.map(p => ({\n        activePair: this.frame === 0 ? new Puyo.PuyoPair() : this.next.get(p.activeNextPos),\n        next1: this.frame === 0 ? this.next.get(0) : this.next.get(p.activeNextPos + 1),\n        next2: this.frame === 0 ? this.next.get(1) : this.next.get(p.activeNextPos + 2),\n        field: p.field,\n        actionHistories: p.actionHistories,\n        chain: p.chain,\n        score: p.score,\n        usedScore: p.usedScore,\n        nonActiveOjama: p.nonActiveOjama,\n        activeOjama: p.activeOjama,\n      })),\n      gameStatusText: this.gameStatusText,\n    };\n  }\n}\n\nexport default {\n  Puyotan: Puyotan,\n  Action: Action,\n  ActionType: ActionType,\n  Player: Player\n}","import React from \"react\";\nimport './Game.css';\nimport Puyo from '../lib/Puyo.js';\nimport Puyotan from '../lib/Puyotan.js';\n\nexport default class Game extends React.Component {\n  constructor(props) {\n    super(props);\n    this.puyotan = new Puyotan.Puyotan();\n    let vm = this.puyotan.getViewModel();\n    this.state = {\n      activePair1: vm.players[0].activePair,\n      activePair2: vm.players[1].activePair,\n      field1: vm.players[0].field,\n      field2: vm.players[1].field,\n      next11: vm.players[0].next1,\n      next12: vm.players[0].next2,\n      next21: vm.players[1].next1,\n      next22: vm.players[1].next2,\n      frame: vm.frame,\n      actionHistories1: vm.players[0].actionHistories,\n      actionHistories2: vm.players[1].actionHistories,\n      controledPos1: 0,\n      controledDir1: 0,\n      controledPos2: 0,\n      controledDir2: 0,\n      isControlledPlayer1: true,\n      isControlledPlayer2: true,\n      chain1: vm.players[0].chain,\n      chain2: vm.players[1].chain,\n      score1: vm.players[0].score,\n      score2: vm.players[1].score,\n      usedScore1: vm.players[0].usedScore,\n      usedScore2: vm.players[1].usedScore,\n      nonActiveOjama1: vm.players[0].nonActiveOjama,\n      nonActiveOjama2: vm.players[1].nonActiveOjama,\n      activeOjama1: vm.players[0].activeOjama,\n      activeOjama2: vm.players[1].activeOjama,\n      gameStatusText: vm.gameStatusText,\n    };\n\n    // keyboard 操作用\n    window.addEventListener('keydown', e => {\n      e.preventDefault();\n      switch (e.keyCode) {\n        case 37: // ←キー\n          this.moveLeft();\n          return\n        case 39: // →キー\n          this.moveRight();\n          return\n        case 38: // ↑キー\n          return\n        case 40: // ↓キー\n          this.putPuyo();\n          return\n        case 49: // 1\n          this.toggleControlledPlayer1();\n          return\n        case 50: // 2\n          this.toggleControlledPlayer2();\n          return\n        case 51: // 3\n          return\n        case 52: // 4\n          return\n        case 53: // 5\n          return\n        case 54: // 6\n          return\n        case 55: // 7\n          return\n        case 56: // 8\n          return\n        case 88: // x\n          this.turnRight();\n          return\n        case 90: // z\n          this.turnLeft();\n          return\n        case 67: // c\n          return\n        case 68: // d\n          return\n        case 69: // e\n          return\n        case 78: // n\n          this.stepNextFrame();\n          return\n        case 80: // p\n          this.pass();\n          return\n        case 82: // r\n          return\n        case 83: // s\n          this.gameStart();\n          return\n        case 84: // t\n          return\n        default:\n          return;\n      }\n    })\n\n    // console 操作用\n    window.Puyotan = Puyotan;\n    window.Game = this;\n    window.put = (id, x, dir) => {\n      this.setAction(id, new Puyotan.Action(Puyotan.ActionType.PUT, x, dir));\n    }\n    window.pass = (id) => {\n      this.setAction(id, new Puyotan.Action(Puyotan.ActionType.PASS));\n    }\n    window.step = () => {\n      this.stepNextFrame();\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"Game\">\n        <div className={`Game-history Game-pos-history1`}>\n          {this.actionHistoriesToElements(this.state.actionHistories1)}\n        </div>\n        <div className={`Game-history Game-pos-history2`}>\n          {this.actionHistoriesToElements(this.state.actionHistories2)}\n        </div>\n        <div className={\"Game-field Game-pos-field1\" + (this.state.isControlledPlayer1 ? \" Game-field-active\" : \"\")}>\n          {this.fieldToElements(this.state.field1)}\n          <div style={({ top: 32 * (13 - this.getSubPos1().y), left: 32 * (this.getSubPos1().x - 1) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair1.sub)}`}></div>\n          <div style={({ top: 32 * (13 - this.getAxisPos1().y), left: 32 * (this.getAxisPos1().x - 1) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair1.axis)}`}></div>\n        </div>\n        <div className={\"Game-field Game-pos-field2\" + (this.state.isControlledPlayer2 ? \" Game-field-active\" : \"\")}>\n          {this.fieldToElements(this.state.field2)}\n          <div style={({ top: 32 * (13 - this.getSubPos2().y), left: 32 * (this.getSubPos2().x - 1) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair2.sub)}`}></div>\n          <div style={({ top: 32 * (13 - this.getAxisPos2().y), left: 32 * (this.getAxisPos2().x - 1) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair2.axis)}`}></div>\n        </div>\n        <div className=\"Game-next Game-pos-next11\">\n          {this.nextToElements(this.state.next11)}\n        </div>\n        <div className=\"Game-next Game-pos-next12\">\n          {this.nextToElements(this.state.next12)}\n        </div>\n        <div className=\"Game-next Game-pos-next21\">\n          {this.nextToElements(this.state.next21)}\n        </div>\n        <div className=\"Game-next Game-pos-next22\">\n          {this.nextToElements(this.state.next22)}\n        </div>\n        <div className=\"Game-pos-chain1\">\n          {this.state.chain1} CHAIN\n        </div>\n        <div className=\"Game-pos-chain2\">\n          {this.state.chain2} CHAIN\n        </div>\n        <div className=\"Game-pos-score1\">\n          {this.state.score1} 点\n        </div>\n        <div className=\"Game-pos-score2\">\n          {this.state.score2} 点\n        </div>\n        <div className=\"Game-pos-usedScore1\">\n          {this.state.usedScore1} 点\n        </div>\n        <div className=\"Game-pos-usedScore2\">\n          {this.state.usedScore2} 点\n        </div>\n        <div className=\"Game-pos-activeOjama1\">\n          アクティブおじゃま {this.state.activeOjama1} 個\n        </div>\n        <div className=\"Game-pos-activeOjama2\">\n          アクティブおじゃま {this.state.activeOjama2} 個\n        </div>\n        <div className=\"Game-pos-nonActiveOjama1\">\n          非アクティブおじゃま {this.state.nonActiveOjama1} 個\n        </div>\n        <div className=\"Game-pos-nonActiveOjama2\">\n          非アクティブおじゃま {this.state.nonActiveOjama2} 個\n        </div>\n        <div className=\"Game-pos-frame\">\n          frame: {this.state.frame}\n        </div>\n        <div className=\"Game-pos-gameStatusText\">\n          statusText: {this.state.gameStatusText}\n        </div>\n        {/* <div>\n          <input type=\"button\" value=\"GameStart\" onClick={e => this.gameStart()} />\n          <input type=\"button\" value=\"StepNextFrame\" onClick={e => this.stepNextFrame()} />\n        </div>\n        <input type=\"button\" value=\"[1P] ON/OFF\" onClick={e => this.toggleControlledPlayer1()} />\n        <input type=\"button\" value=\"[2P] ON/OFF\" onClick={e => this.toggleControlledPlayer2()} /> */}\n      </div>\n    );\n  }\n\n  actionHistoriesToElements(actionHistories) {\n    let array = [];\n    for (let index = this.state.frame; index >= 1; index--) {\n      let history = actionHistories[index];\n      let text = \"\";\n      if (history != null) {\n        switch (history.action.type) {\n          case Puyotan.ActionType.PASS:\n            text = `PASS`\n            break;\n          case Puyotan.ActionType.PUT:\n            text = `PUT(${history.action.x}, ${history.action.dir})`;\n            break;\n          case Puyotan.ActionType.CHAIN:\n            text = `CHAIN`;\n            break;\n          case Puyotan.ActionType.OJAMA:\n            text = `OJAMA`;\n            break;\n          default:\n            text = `unknown type`;\n            break;\n        }\n        text = `${text} ${history.remainingFrame}`;\n      }\n      const style = {\n        top: 32 * (this.state.frame - index)\n      }\n      array.push(<div key={index} style={style} className={`Game-history-tile`}>{index}:{text}</div>);\n    }\n    return array;\n  }\n\n  fieldToElements(field) {\n    return field.map((pos, kind) => {\n      const style = {\n        left: (pos.x - 1) * 32,\n        top: (13 - pos.y) * 32,\n      }\n      const className = this.kindToClassName(kind);\n      return <div key={`${pos.x}_${pos.y}`} style={style} className={`Game-puyo ${className}`}></div>;\n    });\n  }\n\n  nextToElements(pair) {\n    return [\n      <div key={'sub'} className={`Game-puyo ${this.kindToClassName(pair.sub)}`}></div>,\n      <div key={'axs'} className={`Game-puyo ${this.kindToClassName(pair.axis)}`} style={({ top: 32 })}></div>\n    ];\n  }\n\n  kindToClassName(kind) {\n    switch (kind) {\n      case Puyo.Kind.RED: return \"Game-puyo-kind-red\"\n      case Puyo.Kind.BLUE: return \"Game-puyo-kind-blue\"\n      case Puyo.Kind.GREEN: return \"Game-puyo-kind-green\"\n      case Puyo.Kind.YELLOW: return \"Game-puyo-kind-yellow\"\n      case Puyo.Kind.OJAMA: return \"Game-puyo-kind-ojama\"\n      default: return \"Game-puyo-kind-blank\"\n    }\n  }\n\n  toggleControlledPlayer1() {\n    this.setState({ isControlledPlayer1: !this.state.isControlledPlayer1 })\n  }\n\n  toggleControlledPlayer2() {\n    this.setState({ isControlledPlayer2: !this.state.isControlledPlayer2 })\n  }\n\n  reflectPuyotanView() {\n    let vm = this.puyotan.getViewModel();\n    this.setState({\n      activePair1: vm.players[0].activePair,\n      activePair2: vm.players[1].activePair,\n      field1: vm.players[0].field,\n      field2: vm.players[1].field,\n      next11: vm.players[0].next1,\n      next12: vm.players[0].next2,\n      next21: vm.players[1].next1,\n      next22: vm.players[1].next2,\n      frame: vm.frame,\n      actionHistories1: vm.players[0].actionHistories,\n      actionHistories2: vm.players[1].actionHistories,\n      chain1: vm.players[0].chain,\n      chain2: vm.players[1].chain,\n      score1: vm.players[0].score,\n      score2: vm.players[1].score,\n      usedScore1: vm.players[0].usedScore,\n      usedScore2: vm.players[1].usedScore,\n      nonActiveOjama1: vm.players[0].nonActiveOjama,\n      nonActiveOjama2: vm.players[1].nonActiveOjama,\n      activeOjama1: vm.players[0].activeOjama,\n      activeOjama2: vm.players[1].activeOjama,\n      gameStatusText: vm.gameStatusText,\n    })\n  }\n\n  gameStart() {\n    this.puyotan.start();\n    this.reflectPuyotanView();\n    this.setState({\n      controledPos1: 3,\n      controledDir1: 0,\n      controledPos2: 3,\n      controledDir2: 0,\n    })\n  }\n\n  setAction(id, action) {\n    this.puyotan.setAction(id, action);\n  }\n\n  moveLeft() {\n    if (this.state.isControlledPlayer1) if (this.state.controledPos1 > 2 || (this.state.controledPos1 === 2 && this.state.controledDir1 !== 3)) this.setState({ controledPos1: this.state.controledPos1 - 1 });\n    if (this.state.isControlledPlayer2) if (this.state.controledPos2 > 2 || (this.state.controledPos2 === 2 && this.state.controledDir2 !== 3)) this.setState({ controledPos2: this.state.controledPos2 - 1 });\n  }\n\n  moveRight() {\n    if (this.state.isControlledPlayer1) if (this.state.controledPos1 < 5 || (this.state.controledPos1 === 5 && this.state.controledDir1 !== 1)) this.setState({ controledPos1: this.state.controledPos1 + 1 });\n    if (this.state.isControlledPlayer2) if (this.state.controledPos2 < 5 || (this.state.controledPos2 === 5 && this.state.controledDir2 !== 1)) this.setState({ controledPos2: this.state.controledPos2 + 1 });\n  }\n\n  turnLeft() {\n    if (this.state.isControlledPlayer1) {\n      let adjust = 0;\n      if (this.state.controledPos1 === 1 && this.state.controledDir1 === 0) adjust = 1;\n      if (this.state.controledPos1 === 6 && this.state.controledDir1 === 2) adjust = -1;\n      this.setState({ controledDir1: (this.state.controledDir1 + 3) % 4, controledPos1: this.state.controledPos1 + adjust });\n    }\n    if (this.state.isControlledPlayer2) {\n      let adjust = 0;\n      if (this.state.controledPos2 === 1 && this.state.controledDir2 === 0) adjust = 1;\n      if (this.state.controledPos2 === 6 && this.state.controledDir2 === 2) adjust = -1;\n      this.setState({ controledDir2: (this.state.controledDir2 + 3) % 4, controledPos2: this.state.controledPos2 + adjust });\n    }\n  }\n\n  turnRight() {\n    if (this.state.isControlledPlayer1) {\n      let adjust = 0;\n      if (this.state.controledPos1 === 1 && this.state.controledDir1 === 2) adjust = 1;\n      if (this.state.controledPos1 === 6 && this.state.controledDir1 === 0) adjust = -1;\n      this.setState({ controledDir1: (this.state.controledDir1 + 1) % 4, controledPos1: this.state.controledPos1 + adjust });\n    }\n    if (this.state.isControlledPlayer2) {\n      let adjust = 0;\n      if (this.state.controledPos2 === 1 && this.state.controledDir2 === 2) adjust = 1;\n      if (this.state.controledPos2 === 6 && this.state.controledDir2 === 0) adjust = -1;\n      this.setState({ controledDir2: (this.state.controledDir2 + 1) % 4, controledPos2: this.state.controledPos2 + adjust });\n    }\n  }\n\n  putPuyo() {\n    if (this.state.isControlledPlayer1) this.puyotan.setAction(0, new Puyotan.Action(Puyotan.ActionType.PUT, this.state.controledPos1, this.state.controledDir1))\n    if (this.state.isControlledPlayer2) this.puyotan.setAction(1, new Puyotan.Action(Puyotan.ActionType.PUT, this.state.controledPos2, this.state.controledDir2))\n    this.stepNextFrame();\n  }\n\n  pass() {\n    if (this.state.isControlledPlayer1) this.puyotan.setAction(0, new Puyotan.Action(Puyotan.ActionType.PASS));\n    if (this.state.isControlledPlayer2) this.puyotan.setAction(1, new Puyotan.Action(Puyotan.ActionType.PASS));\n    this.stepNextFrame();\n  }\n\n  getAxisPos1() {\n    return new Puyo.Pos(this.state.controledPos1, 12);\n  }\n\n  getAxisPos2() {\n    return new Puyo.Pos(this.state.controledPos2, 12);\n  }\n\n  getSubPos1() {\n    switch (this.state.controledDir1) {\n      case 0: return new Puyo.Pos(this.state.controledPos1, 12 + 1);\n      case 1: return new Puyo.Pos(this.state.controledPos1 + 1, 12);\n      case 2: return new Puyo.Pos(this.state.controledPos1, 12 - 1);\n      case 3: return new Puyo.Pos(this.state.controledPos1 - 1, 12);\n      default: throw Error(`unsupported dir ${this.state.controledDir1}`);\n    }\n  }\n\n  getSubPos2() {\n    switch (this.state.controledDir2) {\n      case 0: return new Puyo.Pos(this.state.controledPos2, 12 + 1);\n      case 1: return new Puyo.Pos(this.state.controledPos2 + 1, 12);\n      case 2: return new Puyo.Pos(this.state.controledPos2, 12 - 1);\n      case 3: return new Puyo.Pos(this.state.controledPos2 - 1, 12);\n      default: throw Error(`unsupported dir ${this.state.controledDir2}`);\n    }\n  }\n\n  stepNextFrame() {\n    this.puyotan.stepNextFrame();\n    this.reflectPuyotanView();\n  }\n}","import React from 'react'\nimport './App.css';\nimport AppHeader from './AppHeader'\nimport Game from './Game'\n\nconst App = () => (\n  <div className='App'>\n    <AppHeader />\n    <Game />\n  </div>\n)\n\nexport default App;\n","import React from 'react';\nimport { render } from 'react-dom';\nimport App from './components/App';\nimport './index.css';\n\nrender(\n  <App />,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}