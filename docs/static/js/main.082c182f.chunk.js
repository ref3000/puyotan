(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(t,e,a){t.exports=a(36)},16:function(t,e,a){},18:function(t,e,a){},20:function(t,e,a){},34:function(t,e,a){},36:function(t,e,a){"use strict";a.r(e);var n=a(0),i=a.n(n),s=a(7),o=(a(16),a(18),function(){return i.a.createElement("div",{className:"AppHeader"},i.a.createElement("div",{className:"AppHeader-title"},"\u3077\u3088\u305f\u3093\u03b2"),i.a.createElement("div",{className:"AppHeader-version"},"v0.1"))}),r=a(1),c=a(2),l=a(9),u=a(8),h=a(10),d=(a(20),function(){function t(e){Object(r.a)(this,t),this.y=null==e?2147483647*Math.random():e}return Object(c.a)(t,[{key:"setSeed",value:function(t){this.y=t}},{key:"next",value:function(){return this.y=this.y^this.y<<13,this.y=this.y^this.y>>17,this.y=this.y^this.y<<15,this.y>>>0}},{key:"nextInt",value:function(t){return Math.abs(this.next())%t}}]),t}()),m={BRANK:0,RED:1,GREEN:2,BLUE:3,YELLOW:4,PURPLE:5,IRON:6,OJAMA:7,WALL:8,PEKE:9},f=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.BRANK,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.BRANK;Object(r.a)(this,t),this.axis=e,this.sub=a},y=function(){function t(e){Object(r.a)(this,t),this.init(e)}return Object(c.a)(t,[{key:"init",value:function(t){null==t&&(t=new d),this._random=t,this._size=1e3,this._puyos=[];for(var e=0;e<this._size;e++)this._puyos.push(new f(this._nextKind(),this._nextKind()))}},{key:"size",value:function(){return this._size}},{key:"get",value:function(t){return this._puyos[t%this._size]}},{key:"edit",value:function(t,e,a){t>=this._size||t<0||(a?this._puyos[t].axis=e:this._puyos[t].sub=e)}},{key:"_nextKind",value:function(){switch(this._random.nextInt(4)){case 0:return m.RED;case 1:return m.GREEN;case 2:return m.BLUE;case 3:return m.YELLOW;default:throw new Error("unexpected error")}}}]),t}(),v=function t(e,a){Object(r.a)(this,t),this.x=isNaN(e)?0:e,this.y=isNaN(a)?0:a},p=function(){function t(){Object(r.a)(this,t),this.height=13,this.width=6,this._field=[];for(var e=0;e<this.height+1;e++){for(var a=[],n=0;n<this.width;n++)a.push(m.BRANK);this._field.push(a)}}return Object(c.a)(t,[{key:"isBrank",value:function(t){return this.get(t)===m.BRANK}},{key:"get",value:function(t){return t.y<1||t.x<1||t.x>this.width?m.WALL:t.y>this.height?m.BRANK:this._field[t.y-1][t.x-1]}},{key:"set",value:function(t,e){t.y<1||t.y>this.height+1||t.x<1||t.x>this.width||(this._field[t.y-1][t.x-1]=e)}},{key:"setAndFall",value:function(t,e){if(t<1||t>this.width)throw RangeError("out of field.");this.isBrank(new v(t,13))&&(this.set(new v(t,13),e),this.fall())}},{key:"fall",value:function(){for(var t=!1,e=1;e<=this.width;e++)for(var a=1,n=1;n<=this.height+1;n++){var i=this.get(new v(e,n));i!==m.BRANK&&(i!==m.WALL?(this.set(new v(e,n),this.get(new v(e,a))),this.set(new v(e,a),i),a!==n&&(t=!0),a++):a=n+1)}for(var s=1;s<=this.width;s++)this.set(new v(s,14),m.BRANK);return t}},{key:"canFall",value:function(){for(var t=1;t<=this.width;t++)for(var e=2;e<=this.height;e++)if(this.isBrank(new v(t,e-1))&&!this.isBrank(new v(t,e))&&this.get(new v(t,e))!==m.WALL)return!0;return!1}},{key:"_countConnection",value:function(t,e,a){return this.get(t)===m.IRON?0:this.get(t)===m.PEKE?0:this.get(t)===m.WALL?0:this.get(t)===m.BRANK?0:this.get(t)===m.OJAMA?0:this.get(t)!==e?0:a.get(t)!==m.BRANK?0:t.y>=13?0:(a.set(t,e),this._countConnection(new v(t.x,t.y+1),e,a)+this._countConnection(new v(t.x+1,t.y),e,a)+this._countConnection(new v(t.x,t.y-1),e,a)+this._countConnection(new v(t.x-1,t.y),e,a)+1)}},{key:"countConnection",value:function(e){return this._countConnection(e,this.get(e),new t)}},{key:"_deleteConnection",value:function(t,e){return this.get(t)===m.BRANK?0:this.get(t)===m.OJAMA?(this.set(t,m.BRANK),0):this.get(t)!==e?0:t.y>=13?0:(this.set(t,m.BRANK),this._deleteConnection(new v(t.x,t.y+1),e)+this._deleteConnection(new v(t.x+1,t.y),e)+this._deleteConnection(new v(t.x,t.y-1),e)+this._deleteConnection(new v(t.x-1,t.y),e)+1)}},{key:"deleteConnection",value:function(t){return this._deleteConnection(t,this.get(t))}},{key:"canFire",value:function(){for(var e=new t,a=1;a<this.height;a++)for(var n=1;n<=this.width;n++){var i=new v(n,a);if(this._countConnection(i,this.get(i),e)>=4)return!0}return!1}},{key:"stepFire",value:function(){for(var e=new function t(){Object(r.a)(this,t),this.num=0,this.connections=[],this.color=0},a=new t,n={},i=1;i<this.height;i++)for(var s=1;s<=this.width;s++){var o=new v(s,i),c=this.get(o),l=this._countConnection(o,c,a);l>=4&&(this.deleteConnection(o),e.num+=l,e.connections.push(l),n[c]=!0)}return e.color=Object.keys(n).length,e}},{key:"Height",value:function(){return this.height}},{key:"Width",value:function(){return this.width}},{key:"copy",value:function(){for(var e=new t,a=1;a<=this.height;a++)for(var n=1;n<=this.width;n++){var i=new v(n,a);e.set(i,this.get(i))}return e}},{key:"equal",value:function(t){for(var e=1;e<=this.height;e++)for(var a=1;a<=this.width;a++){var n=new v(a,e);if(this.get(n)!==t.get(n))return!1}return!0}},{key:"isAllClear",value:function(){for(var t=1;t<=this.height;t++)for(var e=1;e<=this.width;e++){var a=new v(e,t);if(this.get(a)!==m.BRANK)return!1}return!0}},{key:"map",value:function(t){for(var e=[],a=1;a<=this.height;a++)for(var n=1;n<=this.width;n++){var i=new v(n,a),s=this.get(i);e.push(t(i,s))}return e}},{key:"toString",value:function(){var t=this.copy()._field;return t.reverse(),t.map(function(t){return t.join(",")}).join("\n")}}]),t}(),P={Kind:m,Pos:v,Next:y,Field:p,PuyoPair:f},A={PASS:0,PUT:1,CHAIN:2,CHAIN_FALL:3,OJAMA:4},w=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.PASS,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(r.a)(this,t),this.type=e,this.x=a,this.dir=n},g=function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(r.a)(this,t),this.action=e,this.remainingFrame=a},x=function(){function t(e){Object(r.a)(this,t),this.field=new P.Field,this.actionHistories=[],this.activeNextPos=0,this.score=0,this.usedScore=0,this.nonActiveOjama=0,this.activeOjama=0,this.chain=0,this.random=e}return Object(c.a)(t,[{key:"fallOjama",value:function(t){for(;t>0;)if(t>=6){for(var e=1;e<=6;e++)this.field.setAndFall(e,P.Kind.OJAMA);t-=6}else{for(var a=[!1,!1,!1,!1,!1,!1],n=0;n<t;n++)for(var i=this.random.nextInt(6-n),s=0,o=0;o<6;o++)a[o]||s++===i&&(a[o]=!0);for(var r=1;r<=6;r++)a[r-1]&&this.field.setAndFall(r,P.Kind.OJAMA);t=0}}}]),t}(),k={Puyotan:function(){function t(e){Object(r.a)(this,t),this.random=new d(e),this.next=new P.Next(this.random),this.players=[new x(this.random),new x(this.random)],this.frame=0,this.gameStatusText="\u5f85\u6a5f\u4e2d"}return Object(c.a)(t,[{key:"getPlayer",value:function(t){return this.players[t]}},{key:"start",value:function(){0===this.frame&&(this.frame++,this.gameStatusText="\u5bfe\u6226\u4e2d")}},{key:"setAction",value:function(t,e){if(this.frame<=0)return!1;if(null==this.players[t].actionHistories[this.frame])switch(e.type){case A.PASS:return this.players[t].actionHistories[this.frame]=new g(e,0),!0;case A.PUT:return this.players[t].actionHistories[this.frame]=new g(e,1),!0;default:throw new Error("unsupported action type.")}return!1}},{key:"canStepNextFrame",value:function(){var t=this;return!(this.frame<=0)&&this.players.every(function(e){return null!=e.actionHistories[t.frame]})}},{key:"stepNextFrame",value:function(){var t=this;if(!this.canStepNextFrame())return console.error("can not step next frame.");this.players.forEach(function(e,a){var n=e.actionHistories[t.frame];n.remainingFrame>0&&(e.actionHistories[t.frame+1]=new g(n.action,n.remainingFrame-1))}),this.players.forEach(function(e,a){var n=e.actionHistories[t.frame];if(0===n.remainingFrame)switch(n.action.type){case A.PASS:break;case A.PUT:var i=t.next.get(e.activeNextPos),s=n.action.x,o=n.action.dir;switch(o){case 0:e.field.setAndFall(s,i.axis),e.field.setAndFall(s,i.sub);break;case 1:e.field.setAndFall(s,i.axis),e.field.setAndFall(s+1,i.sub);break;case 2:e.field.setAndFall(s,i.sub),e.field.setAndFall(s,i.axis);break;case 3:e.field.setAndFall(s,i.axis),e.field.setAndFall(s-1,i.sub);break;default:throw Error("unsupported direction range or type. ".concat(o))}e.field.canFire()&&(e.chain=0,e.actionHistories[t.frame+1]=new g(new w(A.CHAIN),1));break;case A.CHAIN:var r=e.field.stepFire();e.chain++,e.score+=t.calcScore(r.num,r.color,r.connections,e.chain);var c=Math.floor((e.score-e.usedScore)/70);if(e.usedScore+=70*c,e.nonActiveOjama>0){var l=Math.min(c,e.nonActiveOjama);e.nonActiveOjama-=l,c-=l}if(e.activeOjama>0){var u=Math.min(c,e.activeOjama);e.activeOjama-=u,c-=u}c>0&&t.sendOjama(a,c),e.field.isAllClear()&&(e.score+=2100),e.field.canFall()?e.actionHistories[t.frame+1]=new g(new w(A.CHAIN_FALL),0):t.activeOjama(a);break;case A.CHAIN_FALL:if(!e.field.canFall())throw new Error("failed to fall puyo.");e.field.fall(),e.field.canFire()?e.actionHistories[t.frame+1]=new g(new w(A.CHAIN),1):t.activeOjama(a);break;case A.OJAMA:if(e.activeOjama<=0)throw new Error("failed to fall ojama.");var h=Math.min(e.activeOjama,30);e.activeOjama-=h,e.fallOjama(h);break;default:throw new Error("unsupported action type.")}});var e=0,a=0;this.players.forEach(function(n,i){null==n.actionHistories[t.frame+1]&&n.field.get(new P.Pos(3,12))!==P.Kind.BRANK||(e++,a=i)}),0===e&&(this.gameStatusText="\u5f15\u304d\u5206\u3051\u2026"),1===e&&(this.gameStatusText="Player ".concat(a+1," \u306e\u52dd\u5229\uff01")),this.players.forEach(function(e,a){e.actionHistories[t.frame].action.type!==A.OJAMA&&null==e.actionHistories[t.frame+1]&&e.activeOjama>0&&(e.actionHistories[t.frame+1]=new g(new w(A.OJAMA),0))}),this.players.forEach(function(e,a){var n=e.actionHistories[t.frame],i=e.actionHistories[t.frame+1];n.action.type!==A.PASS&&null==i&&e.activeNextPos++}),this.frame++}},{key:"calcScore",value:function(t,e,a,n){var i=[0,2,3,4,5,6,7,10],s=10*t,o=[0,8,16,32,64,96,128,160,192,224,256,288,320,352,384,416,448,480,512][n-1];void 0===o&&(o=512),o+=[0,3,6,12,24][e-1];for(var r=0;r<a.length;r++){var c=a[r];o+=c>11?10:i[c-4]}return 0===o&&(o=1),s*o}},{key:"sendOjama",value:function(t,e){this.players.forEach(function(a,n){n!==t&&(a.nonActiveOjama+=e)})}},{key:"activeOjama",value:function(t){this.players.forEach(function(e,a){a!==t&&(e.activeOjama+=e.nonActiveOjama,e.nonActiveOjama=0)})}},{key:"getViewModel",value:function(){var t=this;return{frame:this.frame,players:this.players.map(function(e){return{activePair:0===t.frame?new P.PuyoPair:t.next.get(e.activeNextPos),next1:0===t.frame?t.next.get(0):t.next.get(e.activeNextPos+1),next2:0===t.frame?t.next.get(1):t.next.get(e.activeNextPos+2),field:e.field,actionHistories:e.actionHistories,chain:e.chain,score:e.score,usedScore:e.usedScore,nonActiveOjama:e.nonActiveOjama,activeOjama:e.activeOjama}}),gameStatusText:this.gameStatusText}}}]),t}(),Action:w,ActionType:A,Player:x},N=a(4),b=a.n(N);a(29);b.a.initializeApp({apiKey:"AIzaSyDNckvdwFU9B-Xg3YPY-tgsrj09kg0MTxE",authDomain:"puyotan-be458.firebaseapp.com",databaseURL:"https://puyotan-be458.firebaseio.com",projectId:"puyotan-be458",storageBucket:"puyotan-be458.appspot.com",messagingSenderId:"1067679324903"});var E=b.a.firestore();E.settings({timestampsInSnapshots:!0});var C=function(t){function e(t){var a,n,i;return Object(r.a)(this,e),(a=Object(l.a)(this,Object(u.a)(e).call(this,t))).puyotan=new k.Puyotan,a.state={activePair1:new P.PuyoPair,activePair2:new P.PuyoPair,field1:new P.Field,field2:new P.Field,next11:new P.PuyoPair,next12:new P.PuyoPair,next21:new P.PuyoPair,next22:new P.PuyoPair,frame:0,actionHistories1:[],actionHistories2:[],chain1:0,chain2:0,score1:0,score2:0,usedScore1:0,usedScore2:0,nonActiveOjama1:0,nonActiveOjama2:0,activeOjama1:0,activeOjama2:0,gameStatusText:"\u521d\u671f\u5316\u5f85\u3061",controledPos1:0,controledDir1:0,controledPos2:0,controledDir2:0,isControlledPlayer1:!1,isControlledPlayer2:!1,seed:0,displayedSeed:0},a.isControllable=!0,window.addEventListener("keydown",function(t){if(a.isControllable)switch(t.keyCode){case 37:return t.preventDefault(),void a.moveLeft();case 39:return t.preventDefault(),void a.moveRight();case 38:return void t.preventDefault();case 40:return t.preventDefault(),void a.putPuyo();case 49:return void a.toggleControlledPlayer1();case 50:return void a.toggleControlledPlayer2();case 51:case 52:case 53:case 54:case 55:case 56:return;case 88:return void a.turnRight();case 90:return void a.turnLeft();case 67:case 68:case 69:return;case 78:return void a.stepNextFrame();case 80:return void a.pass();case 82:return void a.sendInit(Number(a.state.seed)+1);case 83:case 84:default:return}}),a.dbActions0=[],a.dbActions1=[],E.collection("puyotan").doc("info").onSnapshot(function(t){var e=t.data();null!=e&&(a.dbActions0=[],a.dbActions1=[],a.initPuyotan(e.seed),null!=n&&n(),n=E.collection("puyotan/actions/".concat(e.seed,"/ids/0")).onSnapshot({includeMetadataChanges:!0},function(t){var e=[];t.forEach(function(t){var a=t.data();t.metadata.hasPendingWrites||(e[t.id]={type:a.type,x:a.x,dir:a.dir})}),a.dbActions0=e,a.applyActions()}),null!=i&&i(),i=E.collection("puyotan/actions/".concat(e.seed,"/ids/1")).onSnapshot({includeMetadataChanges:!0},function(t){var e=[];t.forEach(function(t){var a=t.data();t.metadata.hasPendingWrites||(e[t.id]={type:a.type,x:a.x,dir:a.dir})}),a.dbActions1=e,a.applyActions()}))}),a}return Object(h.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){var t=this,e=this.state.actionHistories1[this.state.frame-1],a=null==e?new k.Action:e.action;null!=e&&1!==e.remainingFrame&&a.type===k.ActionType.PUT&&(a=new k.Action(k.ActionType.PUT,3,0));var n=this.state.actionHistories2[this.state.frame-1],s=null==n?new k.Action:n.action;null!=n&&1!==n.remainingFrame&&s.type===k.ActionType.PUT&&(s=new k.Action(k.ActionType.PUT,3,0));var o=this.state.actionHistories1[this.state.frame],r=this.state.actionHistories2[this.state.frame],c=this.state.controledDir1,l=this.state.controledDir2,u=new P.Pos(this.state.controledPos1,12),h=new P.Pos(this.state.controledPos2,12),d=this.state.isControlledPlayer1&&null==o,m=this.state.isControlledPlayer2&&null==r;null!=o&&o.action.type===k.ActionType.PUT&&0===o.remainingFrame?(c=o.action.dir,u=new P.Pos(o.action.x,12),d=!0):null!=o&&o.action.type===k.ActionType.PUT&&1===o.remainingFrame?(this.state.isControlledPlayer1?(c=o.action.dir,u=new P.Pos(o.action.x,12)):(c=0,u=new P.Pos(3,12)),d=!0):null!=o&&o.action.type===k.ActionType.PASS?(c=0,u=new P.Pos(3,12),d=!0):null!=o||this.state.isControlledPlayer1||(c=0,u=new P.Pos(3,12),d=!0),null!=r&&r.action.type===k.ActionType.PUT&&0===r.remainingFrame?(l=r.action.dir,h=new P.Pos(r.action.x,12),m=!0):null!=r&&r.action.type===k.ActionType.PUT&&1===r.remainingFrame?(this.state.isControlledPlayer2?(l=r.action.dir,h=new P.Pos(r.action.x,12)):(l=0,h=new P.Pos(3,12)),m=!0):null!=r&&r.action.type===k.ActionType.PASS?(l=0,h=new P.Pos(3,12),m=!0):null!=r||this.state.isControlledPlayer2||(l=0,h=new P.Pos(3,12),m=!0);var f=this.getSubPos(u,c),y=this.getSubPos(h,l);return i.a.createElement("div",{className:"Game"},i.a.createElement("div",{className:"Game-pos-chain1"},this.state.chain1," CHAIN"),i.a.createElement("div",{className:"Game-pos-chain2"},this.state.chain2," CHAIN"),i.a.createElement("div",{className:"Game-pos-score1"},this.state.score1," \u70b9"),i.a.createElement("div",{className:"Game-pos-score2"},this.state.score2," \u70b9"),i.a.createElement("div",{className:"Game-pos-usedScore1"},this.state.usedScore1," \u70b9"),i.a.createElement("div",{className:"Game-pos-usedScore2"},this.state.usedScore2," \u70b9"),i.a.createElement("div",{className:"Game-pos-activeOjama1"},"\u30a2\u30af\u30c6\u30a3\u30d6\u304a\u3058\u3083\u307e ",this.state.activeOjama1," \u500b"),i.a.createElement("div",{className:"Game-pos-activeOjama2"},"\u30a2\u30af\u30c6\u30a3\u30d6\u304a\u3058\u3083\u307e ",this.state.activeOjama2," \u500b"),i.a.createElement("div",{className:"Game-pos-nonActiveOjama1"},"\u975e\u30a2\u30af\u30c6\u30a3\u30d6\u304a\u3058\u3083\u307e ",this.state.nonActiveOjama1," \u500b"),i.a.createElement("div",{className:"Game-pos-nonActiveOjama2"},"\u975e\u30a2\u30af\u30c6\u30a3\u30d6\u304a\u3058\u3083\u307e ",this.state.nonActiveOjama2," \u500b"),i.a.createElement("div",{className:"Game-pos-frame"},"frame: ",this.state.frame),i.a.createElement("div",{className:"Game-pos-gameStatusText"},"statusText: ",this.state.gameStatusText),i.a.createElement("div",{className:"Game-history Game-pos-history1"},this.actionHistoriesToElements(this.state.actionHistories1)),i.a.createElement("div",{className:"Game-history Game-pos-history2"},this.actionHistoriesToElements(this.state.actionHistories2)),i.a.createElement("div",{className:"Game-field Game-pos-field1"+(this.state.isControlledPlayer1?" Game-field-active":"")},this.fieldToElements(this.state.field1),i.a.createElement("div",{style:{top:32*(10-f.y),left:32*(f.x-1)},className:"Game-puyo ".concat(this.kindToClassName(this.state.activePair1.sub)," ").concat(d?"":"hidden")}),i.a.createElement("div",{style:{top:32*(10-u.y),left:32*(u.x-1)},className:"Game-puyo ".concat(this.kindToClassName(this.state.activePair1.axis)," ").concat(d?"":"hidden")})),i.a.createElement("div",{className:"Game-field Game-pos-field2"+(this.state.isControlledPlayer2?" Game-field-active":"")},this.fieldToElements(this.state.field2),i.a.createElement("div",{style:{top:32*(10-y.y),left:32*(y.x-1)},className:"Game-puyo ".concat(this.kindToClassName(this.state.activePair2.sub)," ").concat(m?"":"hidden")}),i.a.createElement("div",{style:{top:32*(10-h.y),left:32*(h.x-1)},className:"Game-puyo ".concat(this.kindToClassName(this.state.activePair2.axis)," ").concat(m?"":"hidden")})),i.a.createElement("div",{className:"Game-next Game-pos-next11"},this.nextToElements(this.state.next11)),i.a.createElement("div",{className:"Game-next Game-pos-next12"},this.nextToElements(this.state.next12)),i.a.createElement("div",{className:"Game-next Game-pos-next21"},this.nextToElements(this.state.next21)),i.a.createElement("div",{className:"Game-next Game-pos-next22"},this.nextToElements(this.state.next22)),i.a.createElement("input",{type:"button",value:this.state.isControlledPlayer1?"[1P] \u96e2\u5e2d":"[1P] \u7740\u5e2d",onClick:function(e){return t.toggleControlledPlayer1()},className:"Game-button Game-size-onoff Game-pos-onoff1"}),i.a.createElement("input",{type:"button",value:this.state.isControlledPlayer2?"[2P] \u96e2\u5e2d":"[2P] \u7740\u5e2d",onClick:function(e){return t.toggleControlledPlayer2()},className:"Game-button Game-size-onoff Game-pos-onoff2"}),i.a.createElement("input",{type:"button",value:"\u21e6",onClick:function(e){return t.moveLeft()},className:"Game-button Game-size-button Game-pos-leftmove"}),i.a.createElement("input",{type:"button",value:"\u21e8",onClick:function(e){return t.moveRight()},className:"Game-button Game-size-button Game-pos-rightmove"}),i.a.createElement("input",{type:"button",value:"L",onClick:function(e){return t.turnLeft()},className:"Game-button Game-size-button Game-pos-leftturn"}),i.a.createElement("input",{type:"button",value:"R",onClick:function(e){return t.turnRight()},className:"Game-button Game-size-button Game-pos-rightturn"}),i.a.createElement("input",{type:"button",value:"\u21e9",onClick:function(e){return t.putPuyo()},className:"Game-button Game-size-button2 Game-pos-put"}),i.a.createElement("input",{type:"button",value:"Reset",onClick:function(e){return t.sendInit(Number(t.state.seed)+1)},className:"Game-button Game-size-reset Game-pos-reset"}),i.a.createElement("input",{type:"number",value:this.state.displayedSeed,onChange:function(e){return t.setState({displayedSeed:e.target.value})},className:"Game-input-seed"}),i.a.createElement("input",{type:"button",value:"GO",onClick:function(e){return t.sendInit(t.state.displayedSeed)},className:"Game-button Game-size-go Game-pos-go"}))}},{key:"getSubPos",value:function(t,e){switch(e){case 0:return new P.Pos(t.x,t.y+1);case 1:return new P.Pos(t.x+1,t.y);case 2:return new P.Pos(t.x,t.y-1);case 3:return new P.Pos(t.x-1,t.y);default:throw Error("unsupported dir ".concat(this.state.controledDir1))}}},{key:"actionHistoriesToElements",value:function(t){for(var e=[],a=this.state.frame;a>=1;a--){var n=t[a],s="";if(null!=n){switch(n.action.type){case k.ActionType.PASS:s="PASS";break;case k.ActionType.PUT:s="PUT(".concat(n.action.x,", ").concat(n.action.dir,")");break;case k.ActionType.CHAIN:s="CHAIN";break;case k.ActionType.CHAIN_FALL:s="CHAIN_FALL";break;case k.ActionType.OJAMA:s="OJAMA";break;default:s="unknown type"}s="".concat(s," ").concat(n.remainingFrame)}var o={top:32*(this.state.frame-a)};e.push(i.a.createElement("div",{key:a,style:o,className:"Game-history-tile"},a,":",s))}return e}},{key:"fieldToElements",value:function(t){var e=this;return t.map(function(t,a){var n={left:32*(t.x-1),top:32*(13-t.y)},s=e.kindToClassName(a);return i.a.createElement("div",{key:"".concat(t.x,"_").concat(t.y),style:n,className:"Game-puyo ".concat(s)})})}},{key:"nextToElements",value:function(t){return[i.a.createElement("div",{key:"sub",className:"Game-puyo ".concat(this.kindToClassName(t.sub))}),i.a.createElement("div",{key:"axs",className:"Game-puyo ".concat(this.kindToClassName(t.axis)),style:{top:32}})]}},{key:"kindToClassName",value:function(t){switch(t){case P.Kind.RED:return"Game-puyo-kind-red";case P.Kind.BLUE:return"Game-puyo-kind-blue";case P.Kind.GREEN:return"Game-puyo-kind-green";case P.Kind.YELLOW:return"Game-puyo-kind-yellow";case P.Kind.OJAMA:return"Game-puyo-kind-ojama";default:return"Game-puyo-kind-blank"}}},{key:"toggleControlledPlayer1",value:function(){this.setState({isControlledPlayer1:!this.state.isControlledPlayer1})}},{key:"toggleControlledPlayer2",value:function(){this.setState({isControlledPlayer2:!this.state.isControlledPlayer2})}},{key:"reflectPuyotanView",value:function(t){this.setState(this.puyotanViewModelToStateObject(t))}},{key:"moveLeft",value:function(){this.state.isControlledPlayer1&&(this.state.controledPos1>2||2===this.state.controledPos1&&3!==this.state.controledDir1)&&this.setState({controledPos1:this.state.controledPos1-1}),this.state.isControlledPlayer2&&(this.state.controledPos2>2||2===this.state.controledPos2&&3!==this.state.controledDir2)&&this.setState({controledPos2:this.state.controledPos2-1})}},{key:"moveRight",value:function(){this.state.isControlledPlayer1&&(this.state.controledPos1<5||5===this.state.controledPos1&&1!==this.state.controledDir1)&&this.setState({controledPos1:this.state.controledPos1+1}),this.state.isControlledPlayer2&&(this.state.controledPos2<5||5===this.state.controledPos2&&1!==this.state.controledDir2)&&this.setState({controledPos2:this.state.controledPos2+1})}},{key:"turnLeft",value:function(){if(this.state.isControlledPlayer1){var t=0;1===this.state.controledPos1&&0===this.state.controledDir1&&(t=1),6===this.state.controledPos1&&2===this.state.controledDir1&&(t=-1),this.setState({controledDir1:(this.state.controledDir1+3)%4,controledPos1:this.state.controledPos1+t})}if(this.state.isControlledPlayer2){var e=0;1===this.state.controledPos2&&0===this.state.controledDir2&&(e=1),6===this.state.controledPos2&&2===this.state.controledDir2&&(e=-1),this.setState({controledDir2:(this.state.controledDir2+3)%4,controledPos2:this.state.controledPos2+e})}}},{key:"turnRight",value:function(){if(this.state.isControlledPlayer1){var t=0;1===this.state.controledPos1&&2===this.state.controledDir1&&(t=1),6===this.state.controledPos1&&0===this.state.controledDir1&&(t=-1),this.setState({controledDir1:(this.state.controledDir1+1)%4,controledPos1:this.state.controledPos1+t})}if(this.state.isControlledPlayer2){var e=0;1===this.state.controledPos2&&2===this.state.controledDir2&&(e=1),6===this.state.controledPos2&&0===this.state.controledDir2&&(e=-1),this.setState({controledDir2:(this.state.controledDir2+1)%4,controledPos2:this.state.controledPos2+e})}}},{key:"putPuyo",value:function(){this.state.isControlledPlayer1&&this.sendAction(0,this.state.frame,new k.Action(k.ActionType.PUT,this.state.controledPos1,this.state.controledDir1)),this.state.isControlledPlayer2&&this.sendAction(1,this.state.frame,new k.Action(k.ActionType.PUT,this.state.controledPos2,this.state.controledDir2))}},{key:"pass",value:function(){this.state.isControlledPlayer1&&this.sendAction(0,this.state.frame,new k.Action(k.ActionType.PASS)),this.state.isControlledPlayer2&&this.sendAction(1,this.state.frame,new k.Action(k.ActionType.PASS))}},{key:"stepNextFrame",value:function(){var t=this;if(this.puyotan.canStepNextFrame()){this.puyotan.stepNextFrame();var e=this.puyotan.getViewModel();this.reflectPuyotanView(e),null!=e.players[0].actionHistories[e.frame]&&null!=e.players[1].actionHistories[e.frame]?(this.isControllable=!1,setTimeout(function(){t.stepNextFrame()},500)):(this.isControllable=!0,this.applyActions(500))}}},{key:"puyotanViewModelToStateObject",value:function(t){return{activePair1:t.players[0].activePair,activePair2:t.players[1].activePair,field1:t.players[0].field,field2:t.players[1].field,next11:t.players[0].next1,next12:t.players[0].next2,next21:t.players[1].next1,next22:t.players[1].next2,frame:t.frame,actionHistories1:t.players[0].actionHistories,actionHistories2:t.players[1].actionHistories,chain1:t.players[0].chain,chain2:t.players[1].chain,score1:t.players[0].score,score2:t.players[1].score,usedScore1:t.players[0].usedScore,usedScore2:t.players[1].usedScore,nonActiveOjama1:t.players[0].nonActiveOjama,nonActiveOjama2:t.players[1].nonActiveOjama,activeOjama1:t.players[0].activeOjama,activeOjama2:t.players[1].activeOjama,gameStatusText:t.gameStatusText}}},{key:"sendAction",value:function(t,e,a){E.collection("puyotan/actions/".concat(this.state.seed,"/ids/").concat(t)).doc(String(e)).set({type:a.type,x:a.x,dir:a.dir}).then(function(){console.log("Document successfully written!")}).catch(function(t){console.error(t)})}},{key:"setAction",value:function(t,e,a){console.log("setAction(id, frame, action)",t,e,a),this.puyotan.frame===e&&this.puyotan.setAction(t,a)&&(0===t?this.setState({controledPos1:3,controledDir1:0}):this.setState({controledPos2:3,controledDir2:0}),this.stepNextFrame())}},{key:"applyActions",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=this.state.frame,n=this.dbActions0[a],i=this.dbActions1[a];console.log("applyActions(frame, action0, action1)",a,n,i),null==n&&null==i||(e<=0?(null!=n&&this.setAction(0,a,n),null!=i&&this.setAction(1,a,i)):(this.isControllable=!1,setTimeout(function(){null!=n&&t.setAction(0,a,n),null!=i&&t.setAction(1,a,i),t.isControllable=!0},e)))}},{key:"sendInit",value:function(t){null==t&&(t=Math.floor(Math.random()*Math.floor(9999))),E.collection("puyotan").doc("info").set({seed:t}).then(function(){console.log("Document successfully written!")}).catch(function(t){console.error(t)})}},{key:"initPuyotan",value:function(t){console.log("initPuyotan",t),this.puyotan=new k.Puyotan(t),this.puyotan.start();var e=this.puyotan.getViewModel();this.reflectPuyotanView(e),this.setState({seed:t,displayedSeed:t,controledPos1:3,controledDir1:0,controledPos2:3,controledDir2:0})}}]),e}(i.a.Component),O=function(){return i.a.createElement("div",{className:"App"},i.a.createElement(o,null),i.a.createElement(C,null))};a(34);Object(s.render)(i.a.createElement(O,null),document.getElementById("root"))}},[[11,2,1]]]);
//# sourceMappingURL=main.082c182f.chunk.js.map