{"version":3,"sources":["components/AppHeader.js","lib/Random.js","lib/Puyo.js","lib/Puyotan.js","components/Game.js","components/App.js","index.js"],"names":["AppHeader","react_default","a","createElement","className","Random","seed","Object","classCallCheck","this","y","Math","random","max","abs","next","Kind","BRANK","RED","GREEN","BLUE","YELLOW","PURPLE","IRON","OJAMA","WALL","PEKE","PuyoPair","axis","arguments","length","undefined","sub","Next","mode","init","_mode","nextInt","_seed","_random","_size","_puyos","i","push","_nextKind","num","turn","kind","isAxis","Error","Pos","x","isNaN","Field","height","width","_field","line","pos","get","RangeError","isBrank","set","fall","flag","t","p","flags","_countConnection","_deleteConnection","step","Step","connections","color","colorFlags","n","deleteConnection","keys","fd","field","transform","array","copy","reverse","map","join","Puyo","ActionType","PASS","PUT","CHAIN","CHAIN_FALL","Action","type","dir","ActionHistory","action","remainingFrame","Player","actionHistories","activeNextPos","score","usedScore","nonActiveOjama","activeOjama","chain","setAndFall","memo","cnt","j","lib_Puyotan","Puyotan","players","frame","gameStatusText","id","_this","every","_this2","canStepNextFrame","console","error","forEach","currentHistory","tumo","concat","canFire","info","stepFire","calcScore","ojama","floor","usedNum","min","sendOjama","canFall","fallOjamaNum","fallOjama","aliveCount","alivePlayerId","nextHistory","C","base","rate","senderId","_this3","activePair","next1","next2","firebase","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","db","firestore","settings","timestampsInSnapshots","Game","props","possibleConstructorReturn","getPrototypeOf","call","puyotan","vm","getViewModel","state","controledPos1","controledDir1","controledPos2","controledDir2","isControlledPlayer1","isControlledPlayer2","assign","puyotanViewModelToStateObject","isControllable","window","addEventListener","e","preventDefault","keyCode","moveLeft","moveRight","putPuyo","toggleControlledPlayer1","toggleControlledPlayer2","turnRight","turnLeft","stepNextFrame","pass","gameStart","collection","onSnapshot","querySnapshot","doc","setAction","data","actionHistoriesToElements","actionHistories1","actionHistories2","fieldToElements","field1","style","top","getSubPos1","left","kindToClassName","activePair1","getAxisPos1","field2","getSubPos2","activePair2","getAxisPos2","nextToElements","next11","next12","next21","next22","chain1","chain2","score1","score2","usedScore1","usedScore2","activeOjama1","activeOjama2","nonActiveOjama1","nonActiveOjama2","index","history","text","key","pair","setState","start","reflectPuyotanView","String","then","log","catch","adjust","setTimeout","React","Component","App","src_components_AppHeader","Game_Game","render","src_components_App","document","getElementById"],"mappings":"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","file":"static/js/main.509eb19a.chunk.js","sourcesContent":["import React from 'react'\nimport './AppHeader.css';\n\nconst AppHeader = () => (\n  <div className='AppHeader'>\n    <div className='AppHeader-title'>ぷよたんβ</div>\n    <div className='AppHeader-version'>v0.1</div>\n  </div>\n)\n\nexport default AppHeader;\n","class Random {\r\n  constructor (seed) {\r\n    if (seed == null) {\r\n      this.y = Math.random() * 2147483647\r\n    } else {\r\n      this.y = seed\r\n    }\r\n  }\r\n  setSeed (seed) {\r\n    this.y = seed\r\n  }\r\n  next () {\r\n    this.y = this.y ^ (this.y << 13)\r\n    this.y = this.y ^ (this.y >> 17)\r\n    this.y = this.y ^ (this.y << 15)\r\n    return this.y >>> 0\r\n  }\r\n  nextInt (max) { // 0 ~ max未満のランダムな整数を返す\r\n    const r = Math.abs(this.next())\r\n    return r % max\r\n  }\r\n}\r\n\r\nexport default Random\r\n","import Random from './Random'\r\n\r\n/** ぷよの種類用列挙型 */\r\nconst Kind = {\r\n  BRANK: 0,\r\n  RED: 1,\r\n  GREEN: 2,\r\n  BLUE: 3,\r\n  YELLOW: 4,\r\n  PURPLE: 5,\r\n  IRON: 6,\r\n  OJAMA: 7,\r\n  WALL: 8,\r\n  PEKE: 9\r\n}\r\n\r\n//------------------------------------------ クラス定義\r\n/** ぷよの組 */\r\nclass PuyoPair {\r\n  constructor(axis = Kind.BRANK, sub = Kind.BRANK) {\r\n    this.axis = axis\r\n    this.sub = sub\r\n  }\r\n}\r\n\r\n/**\r\n * seed を元に PuyoPair を生成するクラス\r\n * mode は現在 random のみ対応…\r\n */\r\nclass Next {\r\n  constructor(seed, mode) {\r\n    this.init(seed, mode)\r\n  }\r\n  init(seed, mode) {\r\n    if (mode == null) mode = 'random'\r\n    this._mode = mode\r\n    if (seed == null) {\r\n      let r = new Random()\r\n      seed = r.nextInt(64 * 64 * 64 * 64)\r\n    }\r\n    this._seed = seed\r\n    this._random = new Random(this._seed)\r\n    this._size = 1000\r\n    this._puyos = []\r\n    for (let i = 0; i < this._size; i++) {\r\n      this._puyos.push(new PuyoPair(this._nextKind(), this._nextKind()))\r\n    }\r\n  }\r\n  size() {\r\n    return this._size\r\n  }\r\n  get(num) {\r\n    return this._puyos[num % this._size]\r\n  }\r\n  seed() {\r\n    return this._seed\r\n  }\r\n  edit(turn, kind, isAxis) {\r\n    if (turn >= this._size || turn < 0) return\r\n    if (isAxis) {\r\n      this._puyos[turn].axis = kind\r\n    } else {\r\n      this._puyos[turn].sub = kind\r\n    }\r\n  }\r\n  _nextKind() {\r\n    switch (this._random.nextInt(4)) {\r\n      case 0: return Kind.RED\r\n      case 1: return Kind.GREEN\r\n      case 2: return Kind.BLUE\r\n      case 3: return Kind.YELLOW\r\n      default: throw new Error(\"unexpected error\")\r\n    }\r\n  }\r\n}\r\n\r\n/** ぷよの設置位置 */\r\nclass Pos {\r\n  constructor(x, y) {\r\n    this.x = isNaN(x) ? 0 : x\r\n    this.y = isNaN(y) ? 0 : y\r\n  }\r\n}\r\n\r\n/**\r\n * ぷよフィールド\r\n * 6*13のグリッド内に常にぷよが収まる事を想定\r\n * 14段目も考慮する\r\n * fall()後に存在する14段目ぷよは全て消える（通のように残ったりしない）\r\n */\r\nclass Field {\r\n  constructor() {\r\n    this.height = 13\r\n    this.width = 6\r\n    this._field = []\r\n    for (let y = 0; y < this.height + 1; y++) {\r\n      let line = []\r\n      for (let x = 0; x < this.width; x++) {\r\n        line.push(Kind.BRANK)\r\n      }\r\n      this._field.push(line)\r\n    }\r\n  }\r\n  isBrank(pos) {\r\n    return this.get(pos) === Kind.BRANK\r\n  }\r\n  get(pos) {\r\n    if (pos.y < 1 || pos.x < 1 || pos.x > this.width) {\r\n      return Kind.WALL\r\n    }\r\n    if (pos.y > this.height) {\r\n      return Kind.BRANK\r\n    }\r\n    return this._field[pos.y - 1][pos.x - 1]\r\n  }\r\n  set(pos, kind) {\r\n    if (pos.y < 1 || pos.y > this.height + 1 || pos.x < 1 || pos.x > this.width) {\r\n      return\r\n    }\r\n    this._field[pos.y - 1][pos.x - 1] = kind\r\n  }\r\n  setAndFall(x, kind) {\r\n    if (x < 1 || x > this.width) throw RangeError('out of field.');\r\n    if (this.isBrank(new Pos(x, 13))) {\r\n      this.set(new Pos(x, 13), kind);\r\n      this.fall();\r\n    }\r\n  }\r\n  fall() {\r\n    let flag = false // 落下が発生したかどうか\r\n    for (let x = 1; x <= this.width; x++) {\r\n      let t = 1\r\n      for (let y = 1; y <= (this.height + 1); y++) {\r\n        let p = this.get(new Pos(x, y))\r\n        if (p === Kind.BRANK) continue\r\n        if (p === Kind.WALL) {\r\n          t = y + 1\r\n          continue\r\n        }\r\n        this.set(new Pos(x, y), this.get(new Pos(x, t)))\r\n        this.set(new Pos(x, t), p)\r\n        if (t !== y) flag = true\r\n        t++\r\n      }\r\n    }\r\n    for (let x = 1; x <= this.width; x++) this.set(new Pos(x, 14), Kind.BRANK)\r\n    return flag\r\n  }\r\n  canFall() {\r\n    for (let x = 1; x <= this.width; x++) {\r\n      for (let y = 2; y <= this.height; y++) {\r\n        if (this.isBrank(new Pos(x, y - 1)) && !this.isBrank(new Pos(x, y)) && this.get(new Pos(x, y)) !== Kind.WALL) return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n  _countConnection(pos, kind, flags) {\r\n    if (this.get(pos) === Kind.IRON) return 0\r\n    if (this.get(pos) === Kind.PEKE) return 0\r\n    if (this.get(pos) === Kind.WALL) return 0\r\n    if (this.get(pos) === Kind.BRANK) return 0\r\n    if (this.get(pos) === Kind.OJAMA) return 0\r\n    if (this.get(pos) !== kind) return 0\r\n    if (flags.get(pos) !== Kind.BRANK) return 0\r\n    if (pos.y >= 13) return 0\r\n    flags.set(pos, kind)\r\n    return this._countConnection(new Pos(pos.x, pos.y + 1), kind, flags) +\r\n      this._countConnection(new Pos(pos.x + 1, pos.y), kind, flags) +\r\n      this._countConnection(new Pos(pos.x, pos.y - 1), kind, flags) +\r\n      this._countConnection(new Pos(pos.x - 1, pos.y), kind, flags) + 1\r\n  }\r\n  countConnection(pos) {\r\n    return this._countConnection(pos, this.get(pos), new Field())\r\n  }\r\n  _deleteConnection(pos, kind) {\r\n    if (this.get(pos) === Kind.BRANK) return 0\r\n    if (this.get(pos) === Kind.OJAMA) {\r\n      this.set(pos, Kind.BRANK)\r\n      return 0\r\n    }\r\n    if (this.get(pos) !== kind) return 0\r\n    if (pos.y >= 13) return 0\r\n    this.set(pos, Kind.BRANK)\r\n    return this._deleteConnection(new Pos(pos.x, pos.y + 1), kind) +\r\n      this._deleteConnection(new Pos(pos.x + 1, pos.y), kind) +\r\n      this._deleteConnection(new Pos(pos.x, pos.y - 1), kind) +\r\n      this._deleteConnection(new Pos(pos.x - 1, pos.y), kind) + 1\r\n  }\r\n  deleteConnection(pos) {\r\n    return this._deleteConnection(pos, this.get(pos))\r\n  }\r\n  canFire() {\r\n    let flags = new Field()\r\n    for (let y = 1; y < this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        if (this._countConnection(pos, this.get(pos), flags) >= 4) return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n  stepFire() {\r\n    class Step {\r\n      constructor() {\r\n        this.num = 0          // 消えたぷよの数\r\n        this.connections = [] // 連結数\r\n        this.color = 0        // 色数\r\n      }\r\n    }\r\n    let step = new Step()\r\n    let flags = new Field()\r\n    var colorFlags = {}\r\n    for (let y = 1; y < this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        let kind = this.get(pos)\r\n        let n = this._countConnection(pos, kind, flags)\r\n        if (n >= 4) {\r\n          this.deleteConnection(pos)\r\n          step.num += n\r\n          step.connections.push(n)\r\n          colorFlags[kind] = true\r\n        }\r\n      }\r\n    }\r\n    step.color = Object.keys(colorFlags).length\r\n    return step\r\n  }\r\n  Height() {\r\n    return this.height\r\n  }\r\n  Width() {\r\n    return this.width\r\n  }\r\n  copy() {\r\n    let fd = new Field()\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        fd.set(pos, this.get(pos))\r\n      }\r\n    }\r\n    return fd\r\n  }\r\n  equal(field) {\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        if (this.get(pos) !== field.get(pos)) return false\r\n      }\r\n    }\r\n    return true\r\n  }\r\n  isAllClear() {\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        if (this.get(pos) !== Kind.BRANK) return false\r\n      }\r\n    }\r\n    return true\r\n  }\r\n  map(transform) {\r\n    let array = [];\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        let kind = this.get(pos)\r\n        array.push(transform(pos, kind));\r\n      }\r\n    }\r\n    return array;\r\n  }\r\n  toString() {\r\n    let field = this.copy()._field;\r\n    field.reverse();\r\n    return field.map(line => line.join(',')).join('\\n');\r\n  }\r\n}\r\n\r\nexport default {\r\n  Kind: Kind,\r\n  Pos: Pos,\r\n  Next: Next,\r\n  Field: Field,\r\n  PuyoPair: PuyoPair,\r\n}\r\n","import Puyo from './Puyo'\nimport Random from './Random'\n\n/** アクション用列挙型 TODO: v2ではクラス階層で表現する */\nconst ActionType = {\n  PASS: 0,\n  PUT: 1,\n  CHAIN: 2,\n  CHAIN_FALL: 3,\n  OJAMA: 4,\n}\n\nclass Action {\n  constructor(type = ActionType.PASS, x = 0, dir = 0) {\n    this.type = type;\n    this.x = x;\n    this.dir = dir;\n  }\n}\n\nclass ActionHistory {\n  constructor(action, remainingFrame = 0) {\n    this.action = action;\n    this.remainingFrame = remainingFrame;\n  }\n}\n\nclass Player {\n  constructor() {\n    this.field = new Puyo.Field();\n    this.actionHistories = [];\n    this.activeNextPos = 0;\n    this.score = 0;\n    this.usedScore = 0;\n    this.nonActiveOjama = 0;\n    this.activeOjama = 0;\n    this.chain = 0;\n    // 乱数生成器\n    this.random = new Random();\n  }\n\n  fallOjama(num) {\n    while (num > 0) {\n      if (num >= 6) {\n        for (let x = 1; x <= 6; x++) this.field.setAndFall(x, Puyo.Kind.OJAMA);\n        num -= 6;\n      } else {\n        let memo = [false, false, false, false, false, false];\n        for (let i = 0; i < num; i++) {\n          let pos = this.random.nextInt(6 - i);\n          let cnt = 0;\n          for (let j = 0; j < 6; j++) {\n            if (!memo[j]) {\n              if (cnt++ === pos) memo[j] = true;\n            }\n          }\n        }\n        for (let x = 1; x <= 6; x++) {\n          if (memo[x - 1]) this.field.setAndFall(x, Puyo.Kind.OJAMA);\n        }\n        num = 0;\n      }\n    }\n  }\n}\n\nclass Puyotan {\n  constructor() {\n    this.next = new Puyo.Next();\n    this.players = [\n      new Player(),\n      new Player()\n    ];\n    this.frame = 0;\n    this.gameStatusText = \"待機中\";\n  }\n\n  getPlayer(id) {\n    return this.players[id];\n  }\n\n  start() {\n    if (this.frame === 0) {\n      this.frame++;\n      this.gameStatusText = \"対戦中\";\n    }\n  }\n\n  setAction(id, action) {\n    if (this.frame <= 0) return;\n    let history = this.players[id].actionHistories[this.frame];\n    if (history == null) {\n      switch (action.type) {\n        case ActionType.PASS:\n          this.players[id].actionHistories[this.frame] = new ActionHistory(action, 0);\n          break;\n        case ActionType.PUT:\n          this.players[id].actionHistories[this.frame] = new ActionHistory(action, 1);\n          break;\n        default:\n          throw new Error('unsupported action type.');\n      }\n    }\n  }\n\n  canStepNextFrame() {\n    if (this.frame <= 0) return false;\n    return this.players.every(p => p.actionHistories[this.frame] != null);\n  }\n\n  stepNextFrame() {\n    // 2. 行動選択・予約\n    // パス・設置から選択（※硬直中は選択は無効化される）（全プレイヤーが選択するまで待つ）\n    // 設置なら行動予約する（硬直２）\n    if (!this.canStepNextFrame()) {\n      return console.error(`can not step next frame.`);\n    }\n    this.players.forEach((p, id) => {\n      let currentHistory = p.actionHistories[this.frame];\n      if (currentHistory.remainingFrame > 0) {\n        p.actionHistories[this.frame + 1] = new ActionHistory(currentHistory.action, currentHistory.remainingFrame - 1);\n      }\n    });\n    // 3. 行動実行\n    // 硬直カウント減算して０になったら予約された行動を実行\n    // 設置：フィールドに設置、消せるぷよがあれば連鎖を行動予約（硬直３）\n    // 連鎖：ぷよを消去し得点を増加、相殺を処理（非アクティブを優先）し、落下し消せるぷよがあれば連鎖を行動予約（硬直３）、なければ送ったおじゃまをアクティブに\n    // おじゃま：アクティブなおじゃまから最大５段分設置\n    this.players.forEach((p, id) => {\n      const currentHistory = p.actionHistories[this.frame];\n      if (currentHistory.remainingFrame === 0) {\n        switch (currentHistory.action.type) {\n          case ActionType.PASS:\n            break;\n          case ActionType.PUT:\n            let tumo = this.next.get(p.activeNextPos);\n            const x = currentHistory.action.x;\n            const dir = currentHistory.action.dir;\n            switch (dir) {\n              case 0:\n                p.field.setAndFall(x, tumo.axis);\n                p.field.setAndFall(x, tumo.sub);\n                break;\n              case 1:\n                p.field.setAndFall(x, tumo.axis);\n                p.field.setAndFall(x + 1, tumo.sub);\n                break;\n              case 2:\n                p.field.setAndFall(x, tumo.sub);\n                p.field.setAndFall(x, tumo.axis);\n                break;\n              case 3:\n                p.field.setAndFall(x, tumo.axis);\n                p.field.setAndFall(x - 1, tumo.sub);\n                break;\n              default:\n                throw Error(`unsupported direction range or type. ${dir}`);\n            }\n            if (p.field.canFire()) {\n              p.chain = 0;\n              p.actionHistories[this.frame + 1] = new ActionHistory(new Action(ActionType.CHAIN), 1);\n            }\n            break;\n          case ActionType.CHAIN:\n            let info = p.field.stepFire();\n            p.chain++;\n            p.score += this.calcScore(info.num, info.color, info.connections, p.chain);\n            let ojama = Math.floor((p.score - p.usedScore) / 70);\n            p.usedScore += ojama * 70;\n            if (p.nonActiveOjama > 0) {\n              let usedNum = Math.min(ojama, p.nonActiveOjama);\n              p.nonActiveOjama -= usedNum;\n              ojama -= usedNum;\n            }\n            if (p.activeOjama > 0) {\n              let usedNum = Math.min(ojama, p.activeOjama);\n              p.activeOjama -= usedNum;\n              ojama -= usedNum;\n            }\n            if (ojama > 0) {\n              this.sendOjama(id, ojama);\n            }\n            if (p.field.canFall()) {\n              p.actionHistories[this.frame + 1] = new ActionHistory(new Action(ActionType.CHAIN_FALL), 0);\n            } else {\n              this.activeOjama(id);\n            }\n            break;\n          case ActionType.CHAIN_FALL:\n            if (!p.field.canFall()) throw new Error('failed to fall puyo.');\n            p.field.fall();\n            if (p.field.canFire()) {\n              p.actionHistories[this.frame + 1] = new ActionHistory(new Action(ActionType.CHAIN), 1);\n            } else {\n              this.activeOjama(id);\n            }\n            break;\n          case ActionType.OJAMA:\n            if (p.activeOjama <= 0) throw new Error('failed to fall ojama.');\n            let fallOjamaNum = Math.min(p.activeOjama, 30);\n            p.activeOjama -= fallOjamaNum;\n            p.fallOjama(fallOjamaNum);\n            break;\n          default:\n            throw new Error('unsupported action type.');\n        }\n      }\n    });\n    // 4. 窒息判定\n    // 勝敗がついていれば終了\n    let aliveCount = 0;\n    let alivePlayerId = 0;\n    this.players.forEach((p, id) => {\n      if (p.actionHistories[this.frame + 1] == null && p.field.get(new Puyo.Pos(3, 12)) !== Puyo.Kind.BRANK) {\n      } else {\n        aliveCount++;\n        alivePlayerId = id;\n      }\n    });\n    if (aliveCount === 0) {\n      this.gameStatusText = `引き分け…`;\n    }\n    if (aliveCount === 1) {\n      this.gameStatusText = `Player ${alivePlayerId + 1} の勝利！`;\n    }\n    // 5. おじゃま処理\n    // 今フレームがおじゃまでなく次フレームが操作可能でアクティブなおじゃまがあったらおじゃまを行動予約（硬直１）\n    this.players.forEach((p, id) => {\n      if (p.actionHistories[this.frame].action.type !== ActionType.OJAMA && p.actionHistories[this.frame + 1] == null && p.activeOjama > 0) {\n        p.actionHistories[this.frame + 1] = new ActionHistory(new Action(ActionType.OJAMA), 0);\n      }\n    });\n    // 0. フレーム遷移\n    // 今回フレームがパス以外で硬直状態でなければツモを進める\n    this.players.forEach((p, id) => {\n      const currentHistory = p.actionHistories[this.frame];\n      const nextHistory = p.actionHistories[this.frame + 1];\n      if (currentHistory.action.type !== ActionType.PASS && nextHistory == null) {\n        p.activeNextPos++;\n      }\n    });\n    this.frame++;\n  }\n\n  calcScore(num, color, connections, chain) {\n    const A = [0, 8, 16, 32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, 480, 512]\n    const B = [0, 3, 6, 12, 24]\n    const C = [0, 2, 3, 4, 5, 6, 7, 10]\n    let base = num * 10\n    let rate = A[chain - 1]\n    if (rate === undefined) rate = 512\n    rate += B[color - 1]\n    for (let i = 0; i < connections.length; i++) {\n      let n = connections[i]\n      if (n > 11) rate += 10\n      else rate += C[n - 4]\n    }\n    if (rate === 0) rate = 1\n    return base * rate\n  }\n\n  sendOjama(senderId, ojama) {\n    this.players.forEach((p, id) => {\n      if (id !== senderId) {\n        p.nonActiveOjama += ojama;\n      }\n    });\n  }\n\n  activeOjama(senderId) {\n    this.players.forEach((p, id) => {\n      if (id !== senderId) {\n        p.activeOjama += p.nonActiveOjama;\n        p.nonActiveOjama = 0;\n      }\n    });\n  }\n\n  getViewModel() {\n    return {\n      frame: this.frame,\n      players: this.players.map(p => ({\n        activePair: this.frame === 0 ? new Puyo.PuyoPair() : this.next.get(p.activeNextPos),\n        next1: this.frame === 0 ? this.next.get(0) : this.next.get(p.activeNextPos + 1),\n        next2: this.frame === 0 ? this.next.get(1) : this.next.get(p.activeNextPos + 2),\n        field: p.field,\n        actionHistories: p.actionHistories,\n        chain: p.chain,\n        score: p.score,\n        usedScore: p.usedScore,\n        nonActiveOjama: p.nonActiveOjama,\n        activeOjama: p.activeOjama,\n      })),\n      gameStatusText: this.gameStatusText,\n    };\n  }\n}\n\nexport default {\n  Puyotan: Puyotan,\n  Action: Action,\n  ActionType: ActionType,\n  Player: Player\n}","import React from \"react\";\nimport './Game.css';\nimport Puyo from '../lib/Puyo.js';\nimport Puyotan from '../lib/Puyotan.js';\n\nimport firebase from 'firebase/app';\nimport 'firebase/firestore';\n\n//インスタンスの初期化\nfirebase.initializeApp({\n  apiKey: \"AIzaSyDNckvdwFU9B-Xg3YPY-tgsrj09kg0MTxE\",\n  authDomain: \"puyotan-be458.firebaseapp.com\",\n  databaseURL: \"https://puyotan-be458.firebaseio.com\",\n  projectId: \"puyotan-be458\",\n  storageBucket: \"puyotan-be458.appspot.com\",\n  messagingSenderId: \"1067679324903\"\n});\nconst db = firebase.firestore();\nconst settings = { timestampsInSnapshots: true };\ndb.settings(settings);\n\nexport default class Game extends React.Component {\n  constructor(props) {\n    super(props);\n    this.puyotan = new Puyotan.Puyotan();\n    let vm = this.puyotan.getViewModel();\n    this.state = {\n      controledPos1: 0,\n      controledDir1: 0,\n      controledPos2: 0,\n      controledDir2: 0,\n      isControlledPlayer1: true,\n      isControlledPlayer2: true,\n    };\n    Object.assign(this.state, this.puyotanViewModelToStateObject(vm));\n    this.isControllable = true;\n\n    // keyboard 操作用\n    window.addEventListener('keydown', e => {\n      e.preventDefault();\n      if (!this.isControllable) return;\n      switch (e.keyCode) {\n        case 37: // ←キー\n          this.moveLeft();\n          return\n        case 39: // →キー\n          this.moveRight();\n          return\n        case 38: // ↑キー\n          return\n        case 40: // ↓キー\n          this.putPuyo();\n          return\n        case 49: // 1\n          this.toggleControlledPlayer1();\n          return\n        case 50: // 2\n          this.toggleControlledPlayer2();\n          return\n        case 51: // 3\n          return\n        case 52: // 4\n          return\n        case 53: // 5\n          return\n        case 54: // 6\n          return\n        case 55: // 7\n          return\n        case 56: // 8\n          return\n        case 88: // x\n          this.turnRight();\n          return\n        case 90: // z\n          this.turnLeft();\n          return\n        case 67: // c\n          return\n        case 68: // d\n          return\n        case 69: // e\n          return\n        case 78: // n\n          this.stepNextFrame();\n          return\n        case 80: // p\n          this.pass();\n          return\n        case 82: // r\n          return\n        case 83: // s\n          this.gameStart();\n          return\n        case 84: // t\n          return\n        default:\n          return;\n      }\n    })\n\n    // firestore 監視用\n    // let ref = db.collection(\"puyotan\").doc('player1');\n    // ref.orderBy('')\n    db.collection(\"puyotan/histories/0\").onSnapshot((querySnapshot) => {\n      querySnapshot.forEach((doc) => {\n        if (this.state.frame === doc.id) {\n          this.setAction(0, doc.data());\n        }\n      });\n    });\n    db.collection(\"puyotan/histories/1\").onSnapshot((querySnapshot) => {\n      querySnapshot.forEach((doc) => {\n        if (this.state.frame === doc.id) {\n          this.setAction(1, doc.data());\n        }\n      });\n    });\n  }\n\n  render() {\n    return (\n      <div className=\"Game\" >\n        <div className={`Game-history Game-pos-history1`}>\n          {this.actionHistoriesToElements(this.state.actionHistories1)}\n        </div>\n        <div className={`Game-history Game-pos-history2`}>\n          {this.actionHistoriesToElements(this.state.actionHistories2)}\n        </div>\n        <div className={\"Game-field Game-pos-field1\" + (this.state.isControlledPlayer1 ? \" Game-field-active\" : \"\")}>\n          {this.fieldToElements(this.state.field1)}\n          <div style={({ top: 32 * (10 - this.getSubPos1().y), left: 32 * (this.getSubPos1().x - 1) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair1.sub)} ${this.state.actionHistories1[this.state.frame] != null || !this.state.isControlledPlayer1 ? \"hidden\" : \"\"}`}></div>\n          <div style={({ top: 32 * (10 - this.getAxisPos1().y), left: 32 * (this.getAxisPos1().x - 1) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair1.axis)} ${this.state.actionHistories1[this.state.frame] != null || !this.state.isControlledPlayer1 ? \"hidden\" : \"\"}`}></div>\n        </div>\n        <div className={\"Game-field Game-pos-field2\" + (this.state.isControlledPlayer2 ? \" Game-field-active\" : \"\")}>\n          {this.fieldToElements(this.state.field2)}\n          <div style={({ top: 32 * (10 - this.getSubPos2().y), left: 32 * (this.getSubPos2().x - 1) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair2.sub)} ${this.state.actionHistories2[this.state.frame] != null || !this.state.isControlledPlayer2 ? \"hidden\" : \"\"}`}></div>\n          <div style={({ top: 32 * (10 - this.getAxisPos2().y), left: 32 * (this.getAxisPos2().x - 1) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair2.axis)} ${this.state.actionHistories2[this.state.frame] != null || !this.state.isControlledPlayer2 ? \"hidden\" : \"\"}`}></div>\n        </div>\n        <div className=\"Game-next Game-pos-next11\">\n          {this.nextToElements(this.state.next11)}\n        </div>\n        <div className=\"Game-next Game-pos-next12\">\n          {this.nextToElements(this.state.next12)}\n        </div>\n        <div className=\"Game-next Game-pos-next21\">\n          {this.nextToElements(this.state.next21)}\n        </div>\n        <div className=\"Game-next Game-pos-next22\">\n          {this.nextToElements(this.state.next22)}\n        </div>\n        <div className=\"Game-pos-chain1\">\n          {this.state.chain1} CHAIN\n        </div>\n        <div className=\"Game-pos-chain2\">\n          {this.state.chain2} CHAIN\n        </div>\n        <div className=\"Game-pos-score1\">\n          {this.state.score1} 点\n        </div>\n        <div className=\"Game-pos-score2\">\n          {this.state.score2} 点\n        </div>\n        <div className=\"Game-pos-usedScore1\">\n          {this.state.usedScore1} 点\n        </div>\n        <div className=\"Game-pos-usedScore2\">\n          {this.state.usedScore2} 点\n        </div>\n        <div className=\"Game-pos-activeOjama1\">\n          アクティブおじゃま {this.state.activeOjama1} 個\n        </div>\n        <div className=\"Game-pos-activeOjama2\">\n          アクティブおじゃま {this.state.activeOjama2} 個\n        </div>\n        <div className=\"Game-pos-nonActiveOjama1\">\n          非アクティブおじゃま {this.state.nonActiveOjama1} 個\n        </div>\n        <div className=\"Game-pos-nonActiveOjama2\">\n          非アクティブおじゃま {this.state.nonActiveOjama2} 個\n        </div>\n        <div className=\"Game-pos-frame\">\n          frame: {this.state.frame}\n        </div>\n        <div className=\"Game-pos-gameStatusText\">\n          statusText: {this.state.gameStatusText}\n        </div>\n        {/* <div>\n          <input type=\"button\" value=\"GameStart\" onClick={e => this.gameStart()} />\n          <input type=\"button\" value=\"StepNextFrame\" onClick={e => this.stepNextFrame()} />\n        </div>\n        <input type=\"button\" value=\"[1P] ON/OFF\" onClick={e => this.toggleControlledPlayer1()} />\n        <input type=\"button\" value=\"[2P] ON/OFF\" onClick={e => this.toggleControlledPlayer2()} /> */}\n      </div>\n    );\n  }\n\n  actionHistoriesToElements(actionHistories) {\n    let array = [];\n    for (let index = this.state.frame; index >= 1; index--) {\n      let history = actionHistories[index];\n      let text = \"\";\n      if (history != null) {\n        switch (history.action.type) {\n          case Puyotan.ActionType.PASS:\n            text = `PASS`\n            break;\n          case Puyotan.ActionType.PUT:\n            text = `PUT(${history.action.x}, ${history.action.dir})`;\n            break;\n          case Puyotan.ActionType.CHAIN:\n            text = `CHAIN`;\n            break;\n          case Puyotan.ActionType.CHAIN_FALL:\n            text = `CHAIN_FALL`;\n            break;\n          case Puyotan.ActionType.OJAMA:\n            text = `OJAMA`;\n            break;\n          default:\n            text = `unknown type`;\n            break;\n        }\n        text = `${text} ${history.remainingFrame}`;\n      }\n      const style = {\n        top: 32 * (this.state.frame - index)\n      }\n      array.push(<div key={index} style={style} className={`Game-history-tile`}>{index}:{text}</div>);\n    }\n    return array;\n  }\n\n  fieldToElements(field) {\n    return field.map((pos, kind) => {\n      const style = {\n        left: (pos.x - 1) * 32,\n        top: (13 - pos.y) * 32,\n      }\n      const className = this.kindToClassName(kind);\n      return <div key={`${pos.x}_${pos.y}`} style={style} className={`Game-puyo ${className}`}></div>;\n    });\n  }\n\n  nextToElements(pair) {\n    return [\n      <div key={'sub'} className={`Game-puyo ${this.kindToClassName(pair.sub)}`}></div>,\n      <div key={'axs'} className={`Game-puyo ${this.kindToClassName(pair.axis)}`} style={({ top: 32 })}></div>\n    ];\n  }\n\n  kindToClassName(kind) {\n    switch (kind) {\n      case Puyo.Kind.RED: return \"Game-puyo-kind-red\"\n      case Puyo.Kind.BLUE: return \"Game-puyo-kind-blue\"\n      case Puyo.Kind.GREEN: return \"Game-puyo-kind-green\"\n      case Puyo.Kind.YELLOW: return \"Game-puyo-kind-yellow\"\n      case Puyo.Kind.OJAMA: return \"Game-puyo-kind-ojama\"\n      default: return \"Game-puyo-kind-blank\"\n    }\n  }\n\n  toggleControlledPlayer1() {\n    this.setState({ isControlledPlayer1: !this.state.isControlledPlayer1 })\n  }\n\n  toggleControlledPlayer2() {\n    this.setState({ isControlledPlayer2: !this.state.isControlledPlayer2 })\n  }\n\n  reflectPuyotanView(vm) {\n    this.setState(this.puyotanViewModelToStateObject(vm));\n  }\n\n  gameStart() {\n    this.puyotan.start();\n    let vm = this.puyotan.getViewModel();\n    this.reflectPuyotanView(vm);\n    this.setState({\n      controledPos1: 3,\n      controledDir1: 0,\n      controledPos2: 3,\n      controledDir2: 0,\n    })\n  }\n\n  setAction(id, action) {\n    this.puyotan.setAction(id, action);\n    db.collection(`puyotan/histories/${id}`).doc(String(this.state.frame)).set({\n      type: action.type,\n      x: action.x,\n      dir: action.dir,\n    }).then(function () {\n      console.log(\"Document successfully written!\");\n    }).catch(function (error) {\n      throw Error(error);\n    });\n  }\n\n  moveLeft() {\n    if (this.state.isControlledPlayer1) if (this.state.controledPos1 > 2 || (this.state.controledPos1 === 2 && this.state.controledDir1 !== 3)) this.setState({ controledPos1: this.state.controledPos1 - 1 });\n    if (this.state.isControlledPlayer2) if (this.state.controledPos2 > 2 || (this.state.controledPos2 === 2 && this.state.controledDir2 !== 3)) this.setState({ controledPos2: this.state.controledPos2 - 1 });\n  }\n\n  moveRight() {\n    if (this.state.isControlledPlayer1) if (this.state.controledPos1 < 5 || (this.state.controledPos1 === 5 && this.state.controledDir1 !== 1)) this.setState({ controledPos1: this.state.controledPos1 + 1 });\n    if (this.state.isControlledPlayer2) if (this.state.controledPos2 < 5 || (this.state.controledPos2 === 5 && this.state.controledDir2 !== 1)) this.setState({ controledPos2: this.state.controledPos2 + 1 });\n  }\n\n  turnLeft() {\n    if (this.state.isControlledPlayer1) {\n      let adjust = 0;\n      if (this.state.controledPos1 === 1 && this.state.controledDir1 === 0) adjust = 1;\n      if (this.state.controledPos1 === 6 && this.state.controledDir1 === 2) adjust = -1;\n      this.setState({ controledDir1: (this.state.controledDir1 + 3) % 4, controledPos1: this.state.controledPos1 + adjust });\n    }\n    if (this.state.isControlledPlayer2) {\n      let adjust = 0;\n      if (this.state.controledPos2 === 1 && this.state.controledDir2 === 0) adjust = 1;\n      if (this.state.controledPos2 === 6 && this.state.controledDir2 === 2) adjust = -1;\n      this.setState({ controledDir2: (this.state.controledDir2 + 3) % 4, controledPos2: this.state.controledPos2 + adjust });\n    }\n  }\n\n  turnRight() {\n    if (this.state.isControlledPlayer1) {\n      let adjust = 0;\n      if (this.state.controledPos1 === 1 && this.state.controledDir1 === 2) adjust = 1;\n      if (this.state.controledPos1 === 6 && this.state.controledDir1 === 0) adjust = -1;\n      this.setState({ controledDir1: (this.state.controledDir1 + 1) % 4, controledPos1: this.state.controledPos1 + adjust });\n    }\n    if (this.state.isControlledPlayer2) {\n      let adjust = 0;\n      if (this.state.controledPos2 === 1 && this.state.controledDir2 === 2) adjust = 1;\n      if (this.state.controledPos2 === 6 && this.state.controledDir2 === 0) adjust = -1;\n      this.setState({ controledDir2: (this.state.controledDir2 + 1) % 4, controledPos2: this.state.controledPos2 + adjust });\n    }\n  }\n\n  putPuyo() {\n    if (this.state.isControlledPlayer1) {\n      this.setAction(0, new Puyotan.Action(Puyotan.ActionType.PUT, this.state.controledPos1, this.state.controledDir1))\n      this.setState({\n        controledPos1: 3,\n        controledDir1: 0,\n      })\n    }\n    if (this.state.isControlledPlayer2) {\n      this.setAction(1, new Puyotan.Action(Puyotan.ActionType.PUT, this.state.controledPos2, this.state.controledDir2))\n      this.setState({\n        controledPos2: 3,\n        controledDir2: 0,\n      })\n    }\n    this.stepNextFrame();\n  }\n\n  pass() {\n    if (this.state.isControlledPlayer1) {\n      this.setAction(0, new Puyotan.Action(Puyotan.ActionType.PASS));\n      this.setState({\n        controledPos1: 3,\n        controledDir1: 0,\n      })\n    }\n    if (this.state.isControlledPlayer2) {\n      this.setAction(1, new Puyotan.Action(Puyotan.ActionType.PASS));\n      this.setState({\n        controledPos2: 3,\n        controledDir2: 0,\n      })\n    }\n    this.stepNextFrame();\n  }\n\n  getAxisPos1() {\n    return new Puyo.Pos(this.state.controledPos1, 12);\n  }\n\n  getAxisPos2() {\n    return new Puyo.Pos(this.state.controledPos2, 12);\n  }\n\n  getSubPos1() {\n    switch (this.state.controledDir1) {\n      case 0: return new Puyo.Pos(this.state.controledPos1, 12 + 1);\n      case 1: return new Puyo.Pos(this.state.controledPos1 + 1, 12);\n      case 2: return new Puyo.Pos(this.state.controledPos1, 12 - 1);\n      case 3: return new Puyo.Pos(this.state.controledPos1 - 1, 12);\n      default: throw Error(`unsupported dir ${this.state.controledDir1}`);\n    }\n  }\n\n  getSubPos2() {\n    switch (this.state.controledDir2) {\n      case 0: return new Puyo.Pos(this.state.controledPos2, 12 + 1);\n      case 1: return new Puyo.Pos(this.state.controledPos2 + 1, 12);\n      case 2: return new Puyo.Pos(this.state.controledPos2, 12 - 1);\n      case 3: return new Puyo.Pos(this.state.controledPos2 - 1, 12);\n      default: throw Error(`unsupported dir ${this.state.controledDir2}`);\n    }\n  }\n\n  stepNextFrame() {\n    this.puyotan.stepNextFrame();\n    let vm = this.puyotan.getViewModel();\n    this.reflectPuyotanView(vm);\n    if (vm.players[0].actionHistories[vm.frame] != null && vm.players[1].actionHistories[vm.frame] != null) {\n      this.isControllable = false;\n      setTimeout(() => { this.stepNextFrame() }, 500);\n    } else {\n      this.isControllable = true;\n    }\n  }\n\n  puyotanViewModelToStateObject(vm) {\n    return {\n      activePair1: vm.players[0].activePair,\n      activePair2: vm.players[1].activePair,\n      field1: vm.players[0].field,\n      field2: vm.players[1].field,\n      next11: vm.players[0].next1,\n      next12: vm.players[0].next2,\n      next21: vm.players[1].next1,\n      next22: vm.players[1].next2,\n      frame: vm.frame,\n      actionHistories1: vm.players[0].actionHistories,\n      actionHistories2: vm.players[1].actionHistories,\n      chain1: vm.players[0].chain,\n      chain2: vm.players[1].chain,\n      score1: vm.players[0].score,\n      score2: vm.players[1].score,\n      usedScore1: vm.players[0].usedScore,\n      usedScore2: vm.players[1].usedScore,\n      nonActiveOjama1: vm.players[0].nonActiveOjama,\n      nonActiveOjama2: vm.players[1].nonActiveOjama,\n      activeOjama1: vm.players[0].activeOjama,\n      activeOjama2: vm.players[1].activeOjama,\n      gameStatusText: vm.gameStatusText,\n    }\n  }\n}","import React from 'react'\nimport './App.css';\nimport AppHeader from './AppHeader'\nimport Game from './Game'\n\nconst App = () => (\n  <div className='App'>\n    <AppHeader />\n    <Game />\n  </div>\n)\n\nexport default App;\n","import React from 'react';\nimport { render } from 'react-dom';\nimport App from './components/App';\nimport './index.css';\n\nrender(\n  <App />,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}