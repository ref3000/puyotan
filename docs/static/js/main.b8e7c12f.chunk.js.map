{"version":3,"sources":["components/AppHeader.js","lib/Random.js","lib/Puyo.js","lib/Puyotan.js","components/Game.js","components/App.js","index.js"],"names":["AppHeader","react_default","a","createElement","className","Random","seed","Object","classCallCheck","this","y","Math","random","max","abs","next","Kind","BRANK","RED","GREEN","BLUE","YELLOW","PURPLE","IRON","OJAMA","WALL","PEKE","PuyoPair","axis","arguments","length","undefined","sub","Next","init","_random","_size","_puyos","i","push","_nextKind","num","turn","kind","isAxis","nextInt","Error","Pos","x","isNaN","Field","height","width","_field","line","pos","get","RangeError","isBrank","set","fall","flag","t","p","flags","_countConnection","_deleteConnection","step","Step","connections","color","colorFlags","n","deleteConnection","keys","fd","field","transform","array","copy","reverse","map","join","Puyo","ActionType","PASS","PUT","CHAIN","CHAIN_FALL","Action","type","dir","ActionHistory","action","remainingFrame","Player","actionHistories","activeNextPos","score","usedScore","nonActiveOjama","activeOjama","chain","setAndFall","memo","cnt","j","lib_Puyotan","Puyotan","players","frame","gameStatusText","id","_this","every","_this2","canStepNextFrame","console","error","forEach","currentHistory","tumo","concat","canFire","info","stepFire","calcScore","ojama","floor","usedNum","min","sendOjama","isAllClear","canFall","fallOjamaNum","fallOjama","aliveCount","alivePlayerId","nextHistory","C","base","rate","senderId","_this3","activePair","next1","next2","firebase","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","db","firestore","settings","timestampsInSnapshots","Game","props","cancel0","cancel1","possibleConstructorReturn","getPrototypeOf","call","puyotan","state","activePair1","activePair2","field1","field2","next11","next12","next21","next22","actionHistories1","actionHistories2","chain1","chain2","score1","score2","usedScore1","usedScore2","nonActiveOjama1","nonActiveOjama2","activeOjama1","activeOjama2","controledPos1","controledDir1","controledPos2","controledDir2","isControlledPlayer1","isControlledPlayer2","displayedSeed","isControllable","window","addEventListener","e","keyCode","preventDefault","moveLeft","moveRight","putPuyo","toggleControlledPlayer1","toggleControlledPlayer2","turnRight","turnLeft","stepNextFrame","pass","sendInit","Number","dbActions0","dbActions1","collection","doc","onSnapshot","docSnapshot","data","initPuyotan","includeMetadataChanges","querySnapshot","actions","d","metadata","hasPendingWrites","applyActions","prevHistory1","prevAction1","prevHistory2","prevAction2","visibleControlledPuyo1","visibleControlledPuyo2","actionHistoriesToElements","fieldToElements","style","top","getSubPos1","left","kindToClassName","getAxisPos1","getSubDiffY","getSubDiffX","getSubPos2","getAxisPos2","nextToElements","value","onClick","onChange","setState","target","index","history","text","key","pair","vm","puyotanViewModelToStateObject","adjust","sendAction","_this4","getViewModel","reflectPuyotanView","setTimeout","String","then","log","catch","setAction","_this5","waitMs","action0","action1","start","React","Component","App","src_components_AppHeader","Game_Game","render","src_components_App","document","getElementById"],"mappings":"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","file":"static/js/main.b8e7c12f.chunk.js","sourcesContent":["import React from 'react'\nimport './AppHeader.css';\n\nconst AppHeader = () => (\n  <div className='AppHeader'>\n    <div className='AppHeader-title'>ぷよたんβ</div>\n    <div className='AppHeader-version'>v0.1</div>\n  </div>\n)\n\nexport default AppHeader;\n","class Random {\r\n  constructor (seed) {\r\n    if (seed == null) {\r\n      this.y = Math.random() * 2147483647\r\n    } else {\r\n      this.y = seed\r\n    }\r\n  }\r\n  setSeed (seed) {\r\n    this.y = seed\r\n  }\r\n  next () {\r\n    this.y = this.y ^ (this.y << 13)\r\n    this.y = this.y ^ (this.y >> 17)\r\n    this.y = this.y ^ (this.y << 15)\r\n    return this.y >>> 0\r\n  }\r\n  nextInt (max) { // 0 ~ max未満のランダムな整数を返す\r\n    const r = Math.abs(this.next())\r\n    return r % max\r\n  }\r\n}\r\n\r\nexport default Random\r\n","import Random from './Random'\r\n\r\n/** ぷよの種類用列挙型 */\r\nconst Kind = {\r\n  BRANK: 0,\r\n  RED: 1,\r\n  GREEN: 2,\r\n  BLUE: 3,\r\n  YELLOW: 4,\r\n  PURPLE: 5,\r\n  IRON: 6,\r\n  OJAMA: 7,\r\n  WALL: 8,\r\n  PEKE: 9\r\n}\r\n\r\n//------------------------------------------ クラス定義\r\n/** ぷよの組 */\r\nclass PuyoPair {\r\n  constructor(axis = Kind.BRANK, sub = Kind.BRANK) {\r\n    this.axis = axis\r\n    this.sub = sub\r\n  }\r\n}\r\n\r\n/**\r\n * seed を元に PuyoPair を生成するクラス\r\n * mode は現在 random のみ対応…\r\n */\r\nclass Next {\r\n  constructor(random) {\r\n    this.init(random)\r\n  }\r\n  init(random) {\r\n    if (random == null) random = new Random();\r\n    this._random = random;\r\n    this._size = 1000\r\n    this._puyos = []\r\n    for (let i = 0; i < this._size; i++) {\r\n      this._puyos.push(new PuyoPair(this._nextKind(), this._nextKind()))\r\n    }\r\n  }\r\n  size() {\r\n    return this._size\r\n  }\r\n  get(num) {\r\n    return this._puyos[num % this._size]\r\n  }\r\n  edit(turn, kind, isAxis) {\r\n    if (turn >= this._size || turn < 0) return\r\n    if (isAxis) {\r\n      this._puyos[turn].axis = kind\r\n    } else {\r\n      this._puyos[turn].sub = kind\r\n    }\r\n  }\r\n  _nextKind() {\r\n    switch (this._random.nextInt(4)) {\r\n      case 0: return Kind.RED\r\n      case 1: return Kind.GREEN\r\n      case 2: return Kind.BLUE\r\n      case 3: return Kind.YELLOW\r\n      default: throw new Error(\"unexpected error\")\r\n    }\r\n  }\r\n}\r\n\r\n/** ぷよの設置位置 */\r\nclass Pos {\r\n  constructor(x, y) {\r\n    this.x = isNaN(x) ? 0 : x\r\n    this.y = isNaN(y) ? 0 : y\r\n  }\r\n}\r\n\r\n/**\r\n * ぷよフィールド\r\n * 6*13のグリッド内に常にぷよが収まる事を想定\r\n * 14段目も考慮する\r\n * fall()後に存在する14段目ぷよは全て消える（通のように残ったりしない）\r\n */\r\nclass Field {\r\n  constructor() {\r\n    this.height = 13\r\n    this.width = 6\r\n    this._field = []\r\n    for (let y = 0; y < this.height + 1; y++) {\r\n      let line = []\r\n      for (let x = 0; x < this.width; x++) {\r\n        line.push(Kind.BRANK)\r\n      }\r\n      this._field.push(line)\r\n    }\r\n  }\r\n  isBrank(pos) {\r\n    return this.get(pos) === Kind.BRANK\r\n  }\r\n  get(pos) {\r\n    if (pos.y < 1 || pos.x < 1 || pos.x > this.width) {\r\n      return Kind.WALL\r\n    }\r\n    if (pos.y > this.height) {\r\n      return Kind.BRANK\r\n    }\r\n    return this._field[pos.y - 1][pos.x - 1]\r\n  }\r\n  set(pos, kind) {\r\n    if (pos.y < 1 || pos.y > this.height + 1 || pos.x < 1 || pos.x > this.width) {\r\n      return\r\n    }\r\n    this._field[pos.y - 1][pos.x - 1] = kind\r\n  }\r\n  setAndFall(x, kind) {\r\n    if (x < 1 || x > this.width) throw RangeError('out of field.');\r\n    if (this.isBrank(new Pos(x, 13))) {\r\n      this.set(new Pos(x, 13), kind);\r\n      this.fall();\r\n    }\r\n  }\r\n  fall() {\r\n    let flag = false // 落下が発生したかどうか\r\n    for (let x = 1; x <= this.width; x++) {\r\n      let t = 1\r\n      for (let y = 1; y <= (this.height + 1); y++) {\r\n        let p = this.get(new Pos(x, y))\r\n        if (p === Kind.BRANK) continue\r\n        if (p === Kind.WALL) {\r\n          t = y + 1\r\n          continue\r\n        }\r\n        this.set(new Pos(x, y), this.get(new Pos(x, t)))\r\n        this.set(new Pos(x, t), p)\r\n        if (t !== y) flag = true\r\n        t++\r\n      }\r\n    }\r\n    for (let x = 1; x <= this.width; x++) this.set(new Pos(x, 14), Kind.BRANK)\r\n    return flag\r\n  }\r\n  canFall() {\r\n    for (let x = 1; x <= this.width; x++) {\r\n      for (let y = 2; y <= this.height; y++) {\r\n        if (this.isBrank(new Pos(x, y - 1)) && !this.isBrank(new Pos(x, y)) && this.get(new Pos(x, y)) !== Kind.WALL) return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n  _countConnection(pos, kind, flags) {\r\n    if (this.get(pos) === Kind.IRON) return 0\r\n    if (this.get(pos) === Kind.PEKE) return 0\r\n    if (this.get(pos) === Kind.WALL) return 0\r\n    if (this.get(pos) === Kind.BRANK) return 0\r\n    if (this.get(pos) === Kind.OJAMA) return 0\r\n    if (this.get(pos) !== kind) return 0\r\n    if (flags.get(pos) !== Kind.BRANK) return 0\r\n    if (pos.y >= 13) return 0\r\n    flags.set(pos, kind)\r\n    return this._countConnection(new Pos(pos.x, pos.y + 1), kind, flags) +\r\n      this._countConnection(new Pos(pos.x + 1, pos.y), kind, flags) +\r\n      this._countConnection(new Pos(pos.x, pos.y - 1), kind, flags) +\r\n      this._countConnection(new Pos(pos.x - 1, pos.y), kind, flags) + 1\r\n  }\r\n  countConnection(pos) {\r\n    return this._countConnection(pos, this.get(pos), new Field())\r\n  }\r\n  _deleteConnection(pos, kind) {\r\n    if (this.get(pos) === Kind.BRANK) return 0\r\n    if (this.get(pos) === Kind.OJAMA) {\r\n      this.set(pos, Kind.BRANK)\r\n      return 0\r\n    }\r\n    if (this.get(pos) !== kind) return 0\r\n    if (pos.y >= 13) return 0\r\n    this.set(pos, Kind.BRANK)\r\n    return this._deleteConnection(new Pos(pos.x, pos.y + 1), kind) +\r\n      this._deleteConnection(new Pos(pos.x + 1, pos.y), kind) +\r\n      this._deleteConnection(new Pos(pos.x, pos.y - 1), kind) +\r\n      this._deleteConnection(new Pos(pos.x - 1, pos.y), kind) + 1\r\n  }\r\n  deleteConnection(pos) {\r\n    return this._deleteConnection(pos, this.get(pos))\r\n  }\r\n  canFire() {\r\n    let flags = new Field()\r\n    for (let y = 1; y < this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        if (this._countConnection(pos, this.get(pos), flags) >= 4) return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n  stepFire() {\r\n    class Step {\r\n      constructor() {\r\n        this.num = 0          // 消えたぷよの数\r\n        this.connections = [] // 連結数\r\n        this.color = 0        // 色数\r\n      }\r\n    }\r\n    let step = new Step()\r\n    let flags = new Field()\r\n    var colorFlags = {}\r\n    for (let y = 1; y < this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        let kind = this.get(pos)\r\n        let n = this._countConnection(pos, kind, flags)\r\n        if (n >= 4) {\r\n          this.deleteConnection(pos)\r\n          step.num += n\r\n          step.connections.push(n)\r\n          colorFlags[kind] = true\r\n        }\r\n      }\r\n    }\r\n    step.color = Object.keys(colorFlags).length\r\n    return step\r\n  }\r\n  Height() {\r\n    return this.height\r\n  }\r\n  Width() {\r\n    return this.width\r\n  }\r\n  copy() {\r\n    let fd = new Field()\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        fd.set(pos, this.get(pos))\r\n      }\r\n    }\r\n    return fd\r\n  }\r\n  equal(field) {\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        if (this.get(pos) !== field.get(pos)) return false\r\n      }\r\n    }\r\n    return true\r\n  }\r\n  isAllClear() {\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        if (this.get(pos) !== Kind.BRANK) return false\r\n      }\r\n    }\r\n    return true\r\n  }\r\n  map(transform) {\r\n    let array = [];\r\n    for (let y = 1; y <= this.height; y++) {\r\n      for (let x = 1; x <= this.width; x++) {\r\n        let pos = new Pos(x, y)\r\n        let kind = this.get(pos)\r\n        array.push(transform(pos, kind));\r\n      }\r\n    }\r\n    return array;\r\n  }\r\n  toString() {\r\n    let field = this.copy()._field;\r\n    field.reverse();\r\n    return field.map(line => line.join(',')).join('\\n');\r\n  }\r\n}\r\n\r\nexport default {\r\n  Kind: Kind,\r\n  Pos: Pos,\r\n  Next: Next,\r\n  Field: Field,\r\n  PuyoPair: PuyoPair,\r\n}\r\n","import Puyo from './Puyo'\nimport Random from './Random'\n\n/** アクション用列挙型 TODO: v2ではクラス階層で表現する */\nconst ActionType = {\n  PASS: 0,\n  PUT: 1,\n  CHAIN: 2,\n  CHAIN_FALL: 3,\n  OJAMA: 4,\n}\n\nclass Action {\n  constructor(type = ActionType.PASS, x = 0, dir = 0) {\n    this.type = type;\n    this.x = x;\n    this.dir = dir;\n  }\n}\n\nclass ActionHistory {\n  constructor(action, remainingFrame = 0) {\n    this.action = action;\n    this.remainingFrame = remainingFrame;\n  }\n}\n\nclass Player {\n  constructor(random) {\n    this.field = new Puyo.Field();\n    this.actionHistories = [];\n    this.activeNextPos = 0;\n    this.score = 0;\n    this.usedScore = 0;\n    this.nonActiveOjama = 0;\n    this.activeOjama = 0;\n    this.chain = 0;\n    // 乱数生成器\n    this.random = random;\n  }\n\n  fallOjama(num) {\n    while (num > 0) {\n      if (num >= 6) {\n        for (let x = 1; x <= 6; x++) this.field.setAndFall(x, Puyo.Kind.OJAMA);\n        num -= 6;\n      } else {\n        let memo = [false, false, false, false, false, false];\n        for (let i = 0; i < num; i++) {\n          let pos = this.random.nextInt(6 - i);\n          let cnt = 0;\n          for (let j = 0; j < 6; j++) {\n            if (!memo[j]) {\n              if (cnt++ === pos) memo[j] = true;\n            }\n          }\n        }\n        for (let x = 1; x <= 6; x++) {\n          if (memo[x - 1]) this.field.setAndFall(x, Puyo.Kind.OJAMA);\n        }\n        num = 0;\n      }\n    }\n  }\n}\n\nclass Puyotan {\n  constructor(seed) {\n    this.random = new Random(seed);\n    this.next = new Puyo.Next(this.random);\n    this.players = [\n      new Player(this.random),\n      new Player(this.random)\n    ];\n    this.frame = 0;\n    this.gameStatusText = \"待機中\";\n  }\n\n  getPlayer(id) {\n    return this.players[id];\n  }\n\n  start() {\n    if (this.frame === 0) {\n      this.frame++;\n      this.gameStatusText = \"対戦中\";\n    }\n  }\n\n  setAction(id, action) {\n    if (this.frame <= 0) return false;\n    let history = this.players[id].actionHistories[this.frame];\n    if (history == null) {\n      switch (action.type) {\n        case ActionType.PASS:\n          this.players[id].actionHistories[this.frame] = new ActionHistory(action, 0);\n          return true;\n        case ActionType.PUT:\n          this.players[id].actionHistories[this.frame] = new ActionHistory(action, 1);\n          return true;\n        default:\n          throw new Error('unsupported action type.');\n      }\n    }\n    return false;\n  }\n\n  canStepNextFrame() {\n    if (this.frame <= 0) return false;\n    return this.players.every(p => p.actionHistories[this.frame] != null);\n  }\n\n  stepNextFrame() {\n    // 2. 行動選択・予約\n    // パス・設置から選択（※硬直中は選択は無効化される）（全プレイヤーが選択するまで待つ）\n    // 設置なら行動予約する（硬直２）\n    if (!this.canStepNextFrame()) {\n      return console.error(`can not step next frame.`);\n    }\n    this.players.forEach((p, id) => {\n      let currentHistory = p.actionHistories[this.frame];\n      if (currentHistory.remainingFrame > 0) {\n        p.actionHistories[this.frame + 1] = new ActionHistory(currentHistory.action, currentHistory.remainingFrame - 1);\n      }\n    });\n    // 3. 行動実行\n    // 硬直カウント減算して０になったら予約された行動を実行\n    // 設置：フィールドに設置、消せるぷよがあれば連鎖を行動予約（硬直３）\n    // 連鎖：ぷよを消去し得点を増加、相殺を処理（非アクティブを優先）し、落下し消せるぷよがあれば連鎖を行動予約（硬直３）、なければ送ったおじゃまをアクティブに\n    // おじゃま：アクティブなおじゃまから最大５段分設置\n    this.players.forEach((p, id) => {\n      const currentHistory = p.actionHistories[this.frame];\n      if (currentHistory.remainingFrame === 0) {\n        switch (currentHistory.action.type) {\n          case ActionType.PASS:\n            break;\n          case ActionType.PUT:\n            let tumo = this.next.get(p.activeNextPos);\n            const x = currentHistory.action.x;\n            const dir = currentHistory.action.dir;\n            switch (dir) {\n              case 0:\n                p.field.setAndFall(x, tumo.axis);\n                p.field.setAndFall(x, tumo.sub);\n                break;\n              case 1:\n                p.field.setAndFall(x, tumo.axis);\n                p.field.setAndFall(x + 1, tumo.sub);\n                break;\n              case 2:\n                p.field.setAndFall(x, tumo.sub);\n                p.field.setAndFall(x, tumo.axis);\n                break;\n              case 3:\n                p.field.setAndFall(x, tumo.axis);\n                p.field.setAndFall(x - 1, tumo.sub);\n                break;\n              default:\n                throw Error(`unsupported direction range or type. ${dir}`);\n            }\n            if (p.field.canFire()) {\n              p.chain = 0;\n              p.actionHistories[this.frame + 1] = new ActionHistory(new Action(ActionType.CHAIN), 1);\n            }\n            break;\n          case ActionType.CHAIN:\n            let info = p.field.stepFire();\n            p.chain++;\n            p.score += this.calcScore(info.num, info.color, info.connections, p.chain);\n            let ojama = Math.floor((p.score - p.usedScore) / 70);\n            p.usedScore += ojama * 70;\n            if (p.nonActiveOjama > 0) {\n              let usedNum = Math.min(ojama, p.nonActiveOjama);\n              p.nonActiveOjama -= usedNum;\n              ojama -= usedNum;\n            }\n            if (p.activeOjama > 0) {\n              let usedNum = Math.min(ojama, p.activeOjama);\n              p.activeOjama -= usedNum;\n              ojama -= usedNum;\n            }\n            if (ojama > 0) {\n              this.sendOjama(id, ojama);\n            }\n            if (p.field.isAllClear()) {\n              p.score += 2100;\n            }\n            if (p.field.canFall()) {\n              p.actionHistories[this.frame + 1] = new ActionHistory(new Action(ActionType.CHAIN_FALL), 0);\n            } else {\n              this.activeOjama(id);\n            }\n            break;\n          case ActionType.CHAIN_FALL:\n            if (!p.field.canFall()) throw new Error('failed to fall puyo.');\n            p.field.fall();\n            if (p.field.canFire()) {\n              p.actionHistories[this.frame + 1] = new ActionHistory(new Action(ActionType.CHAIN), 1);\n            } else {\n              this.activeOjama(id);\n            }\n            break;\n          case ActionType.OJAMA:\n            if (p.activeOjama <= 0) throw new Error('failed to fall ojama.');\n            let fallOjamaNum = Math.min(p.activeOjama, 30);\n            p.activeOjama -= fallOjamaNum;\n            p.fallOjama(fallOjamaNum);\n            break;\n          default:\n            throw new Error('unsupported action type.');\n        }\n      }\n    });\n    // 4. 窒息判定\n    // 勝敗がついていれば終了\n    let aliveCount = 0;\n    let alivePlayerId = 0;\n    this.players.forEach((p, id) => {\n      if (p.actionHistories[this.frame + 1] == null && p.field.get(new Puyo.Pos(3, 12)) !== Puyo.Kind.BRANK) {\n      } else {\n        aliveCount++;\n        alivePlayerId = id;\n      }\n    });\n    if (aliveCount === 0) {\n      this.gameStatusText = `引き分け…`;\n    }\n    if (aliveCount === 1) {\n      this.gameStatusText = `Player ${alivePlayerId + 1} の勝利！`;\n    }\n    // 5. おじゃま処理\n    // 今フレームがおじゃまでなく次フレームが操作可能でアクティブなおじゃまがあったらおじゃまを行動予約（硬直１）\n    this.players.forEach((p, id) => {\n      if (p.actionHistories[this.frame].action.type !== ActionType.OJAMA && p.actionHistories[this.frame + 1] == null && p.activeOjama > 0) {\n        p.actionHistories[this.frame + 1] = new ActionHistory(new Action(ActionType.OJAMA), 0);\n      }\n    });\n    // 0. フレーム遷移\n    // 今回フレームがパス以外で硬直状態でなければツモを進める\n    this.players.forEach((p, id) => {\n      const currentHistory = p.actionHistories[this.frame];\n      const nextHistory = p.actionHistories[this.frame + 1];\n      if (currentHistory.action.type !== ActionType.PASS && nextHistory == null) {\n        p.activeNextPos++;\n      }\n    });\n    this.frame++;\n  }\n\n  calcScore(num, color, connections, chain) {\n    const A = [0, 8, 16, 32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, 480, 512]\n    const B = [0, 3, 6, 12, 24]\n    const C = [0, 2, 3, 4, 5, 6, 7, 10]\n    let base = num * 10\n    let rate = A[chain - 1]\n    if (rate === undefined) rate = 512\n    rate += B[color - 1]\n    for (let i = 0; i < connections.length; i++) {\n      let n = connections[i]\n      if (n > 11) rate += 10\n      else rate += C[n - 4]\n    }\n    if (rate === 0) rate = 1\n    return base * rate\n  }\n\n  sendOjama(senderId, ojama) {\n    this.players.forEach((p, id) => {\n      if (id !== senderId) {\n        p.nonActiveOjama += ojama;\n      }\n    });\n  }\n\n  activeOjama(senderId) {\n    this.players.forEach((p, id) => {\n      if (id !== senderId) {\n        p.activeOjama += p.nonActiveOjama;\n        p.nonActiveOjama = 0;\n      }\n    });\n  }\n\n  getViewModel() {\n    return {\n      frame: this.frame,\n      players: this.players.map(p => ({\n        activePair: this.frame === 0 ? new Puyo.PuyoPair() : this.next.get(p.activeNextPos),\n        next1: this.frame === 0 ? this.next.get(0) : this.next.get(p.activeNextPos + 1),\n        next2: this.frame === 0 ? this.next.get(1) : this.next.get(p.activeNextPos + 2),\n        field: p.field,\n        actionHistories: p.actionHistories,\n        chain: p.chain,\n        score: p.score,\n        usedScore: p.usedScore,\n        nonActiveOjama: p.nonActiveOjama,\n        activeOjama: p.activeOjama,\n      })),\n      gameStatusText: this.gameStatusText,\n    };\n  }\n}\n\nexport default {\n  Puyotan: Puyotan,\n  Action: Action,\n  ActionType: ActionType,\n  Player: Player\n}","import React from \"react\";\nimport './Game.css';\nimport Puyo from '../lib/Puyo.js';\nimport Puyotan from '../lib/Puyotan.js';\n\nimport firebase from 'firebase/app';\nimport 'firebase/firestore';\n\n//インスタンスの初期化\nfirebase.initializeApp({\n  apiKey: \"AIzaSyDNckvdwFU9B-Xg3YPY-tgsrj09kg0MTxE\",\n  authDomain: \"puyotan-be458.firebaseapp.com\",\n  databaseURL: \"https://puyotan-be458.firebaseio.com\",\n  projectId: \"puyotan-be458\",\n  storageBucket: \"puyotan-be458.appspot.com\",\n  messagingSenderId: \"1067679324903\"\n});\nconst db = firebase.firestore();\nconst settings = { timestampsInSnapshots: true };\ndb.settings(settings);\n\nexport default class Game extends React.Component {\n  constructor(props) {\n    super(props);\n    this.puyotan = new Puyotan.Puyotan();\n    this.state = {\n      activePair1: new Puyo.PuyoPair(),\n      activePair2: new Puyo.PuyoPair(),\n      field1: new Puyo.Field(),\n      field2: new Puyo.Field(),\n      next11: new Puyo.PuyoPair(),\n      next12: new Puyo.PuyoPair(),\n      next21: new Puyo.PuyoPair(),\n      next22: new Puyo.PuyoPair(),\n      frame: 0,\n      actionHistories1: [],\n      actionHistories2: [],\n      chain1: 0,\n      chain2: 0,\n      score1: 0,\n      score2: 0,\n      usedScore1: 0,\n      usedScore2: 0,\n      nonActiveOjama1: 0,\n      nonActiveOjama2: 0,\n      activeOjama1: 0,\n      activeOjama2: 0,\n      gameStatusText: '初期化待ち',\n\n      controledPos1: 0,\n      controledDir1: 0,\n      controledPos2: 0,\n      controledDir2: 0,\n      isControlledPlayer1: false,\n      isControlledPlayer2: false,\n\n      seed: 0,\n      displayedSeed: 0,\n    };\n    // Object.assign(this.state, this.puyotanViewModelToStateObject(vm));\n    this.isControllable = true;\n\n    // keyboard 操作用\n    window.addEventListener('keydown', e => {\n      // e.preventDefault();\n      if (!this.isControllable) return;\n      switch (e.keyCode) {\n        case 37: // ←キー\n          e.preventDefault();\n          this.moveLeft();\n          return\n        case 39: // →キー\n          e.preventDefault();\n          this.moveRight();\n          return\n        case 38: // ↑キー\n          e.preventDefault();\n          return\n        case 40: // ↓キー\n          e.preventDefault();\n          this.putPuyo();\n          return\n        case 49: // 1\n          this.toggleControlledPlayer1();\n          return\n        case 50: // 2\n          this.toggleControlledPlayer2();\n          return\n        case 51: // 3\n          return\n        case 52: // 4\n          return\n        case 53: // 5\n          return\n        case 54: // 6\n          return\n        case 55: // 7\n          return\n        case 56: // 8\n          return\n        case 88: // x\n          this.turnRight();\n          return\n        case 90: // z\n          this.turnLeft();\n          return\n        case 67: // c\n          return\n        case 68: // d\n          return\n        case 69: // e\n          return\n        case 78: // n\n          this.stepNextFrame();\n          return\n        case 80: // p\n          this.pass();\n          return\n        case 82: // r\n          this.sendInit(Number(this.state.seed) + 1);\n          return\n        case 83: // s\n          // this.sendInit();\n          return\n        case 84: // t\n          return\n        default:\n          return;\n      }\n    })\n\n    // firestore 監視用\n    this.dbActions0 = [];\n    this.dbActions1 = [];\n    let cancel0;\n    let cancel1;\n    db.collection(\"puyotan\").doc(\"info\").onSnapshot((docSnapshot) => {\n      let info = docSnapshot.data();\n      if (info == null) return;\n      this.dbActions0 = [];\n      this.dbActions1 = [];\n      this.initPuyotan(info.seed);\n      if (cancel0 != null) cancel0();\n      cancel0 = db.collection(`puyotan/actions/${info.seed}/ids/0`).onSnapshot({ includeMetadataChanges: true }, (querySnapshot) => {\n        let actions = [];\n        querySnapshot.forEach((doc) => {\n          let d = doc.data();\n          if (!doc.metadata.hasPendingWrites) {\n            actions[doc.id] = {\n              type: d.type,\n              x: d.x,\n              dir: d.dir,\n            }\n          }\n        });\n        this.dbActions0 = actions;\n        this.applyActions();\n      });\n      if (cancel1 != null) cancel1();\n      cancel1 = db.collection(`puyotan/actions/${info.seed}/ids/1`).onSnapshot({ includeMetadataChanges: true }, (querySnapshot) => {\n        let actions = [];\n        querySnapshot.forEach((doc) => {\n          let d = doc.data();\n          if (!doc.metadata.hasPendingWrites) {\n            actions[doc.id] = {\n              type: d.type,\n              x: d.x,\n              dir: d.dir,\n            }\n          }\n        });\n        this.dbActions1 = actions;\n        this.applyActions();\n      });\n    });\n  }\n\n  render() {\n    let prevHistory1 = this.state.actionHistories1[this.state.frame - 1];\n    let prevAction1 = (prevHistory1 == null ? new Puyotan.Action() : prevHistory1.action)\n    if (prevHistory1 != null && prevHistory1.remainingFrame !== 1 && prevAction1.type === Puyotan.ActionType.PUT) prevAction1 = new Puyotan.Action(Puyotan.ActionType.PUT, 3, 0);\n    let prevHistory2 = this.state.actionHistories2[this.state.frame - 1];\n    let prevAction2 = (prevHistory2 == null ? new Puyotan.Action() : prevHistory2.action)\n    if (prevHistory2 != null && prevHistory2.remainingFrame !== 1 && prevAction2.type === Puyotan.ActionType.PUT) prevAction2 = new Puyotan.Action(Puyotan.ActionType.PUT, 3, 0);\n    let visibleControlledPuyo1 = this.state.actionHistories1[this.state.frame] != null || !this.state.isControlledPlayer1;\n    let visibleControlledPuyo2 = this.state.actionHistories2[this.state.frame] != null || !this.state.isControlledPlayer2;\n    return (\n      <div className=\"Game\" >\n        <div className=\"Game-pos-chain1\">\n          {this.state.chain1} CHAIN\n        </div>\n        <div className=\"Game-pos-chain2\">\n          {this.state.chain2} CHAIN\n        </div>\n        <div className=\"Game-pos-score1\">\n          {this.state.score1} 点\n        </div>\n        <div className=\"Game-pos-score2\">\n          {this.state.score2} 点\n        </div>\n        <div className=\"Game-pos-usedScore1\">\n          {this.state.usedScore1} 点\n        </div>\n        <div className=\"Game-pos-usedScore2\">\n          {this.state.usedScore2} 点\n        </div>\n        <div className=\"Game-pos-activeOjama1\">\n          アクティブおじゃま {this.state.activeOjama1} 個\n        </div>\n        <div className=\"Game-pos-activeOjama2\">\n          アクティブおじゃま {this.state.activeOjama2} 個\n        </div>\n        <div className=\"Game-pos-nonActiveOjama1\">\n          非アクティブおじゃま {this.state.nonActiveOjama1} 個\n        </div>\n        <div className=\"Game-pos-nonActiveOjama2\">\n          非アクティブおじゃま {this.state.nonActiveOjama2} 個\n        </div>\n        <div className=\"Game-pos-frame\">\n          frame: {this.state.frame}\n        </div>\n        <div className=\"Game-pos-gameStatusText\">\n          statusText: {this.state.gameStatusText}\n        </div>\n        <div className={`Game-history Game-pos-history1`}>\n          {this.actionHistoriesToElements(this.state.actionHistories1)}\n        </div>\n        <div className={`Game-history Game-pos-history2`}>\n          {this.actionHistoriesToElements(this.state.actionHistories2)}\n        </div>\n        <div className={\"Game-field Game-pos-field1\" + (this.state.isControlledPlayer1 ? \" Game-field-active\" : \"\")}>\n          {this.fieldToElements(this.state.field1)}\n          <div style={({ top: 32 * (10 - this.getSubPos1().y), left: 32 * (this.getSubPos1().x - 1) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair1.sub)} ${visibleControlledPuyo1 ? \"hidden\" : \"\"}`}></div>\n          <div style={({ top: 32 * (10 - this.getAxisPos1().y), left: 32 * (this.getAxisPos1().x - 1) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair1.axis)} ${visibleControlledPuyo1 ? \"hidden\" : \"\"}`}></div>\n          <div style={({ top: 32 * (-1 + this.getSubDiffY(prevAction1.dir)), left: 32 * (prevAction1.x - 1 + this.getSubDiffX(prevAction1.dir)) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair1.sub)} ${(prevAction1.type === Puyotan.ActionType.PUT) && prevHistory1.remainingFrame === 1 ? \"\" : \"hidden\"}`}></div>\n          <div style={({ top: 32 * -1, left: 32 * (prevAction1.x - 1) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair1.axis)} ${(prevAction1.type === Puyotan.ActionType.PUT) && prevHistory1.remainingFrame === 1 ? \"\" : \"hidden\"}`}></div>\n        </div>\n        <div className={\"Game-field Game-pos-field2\" + (this.state.isControlledPlayer2 ? \" Game-field-active\" : \"\")}>\n          {this.fieldToElements(this.state.field2)}\n          <div style={({ top: 32 * (10 - this.getSubPos2().y), left: 32 * (this.getSubPos2().x - 1) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair2.sub)} ${visibleControlledPuyo2 ? \"hidden\" : \"\"}`}></div>\n          <div style={({ top: 32 * (10 - this.getAxisPos2().y), left: 32 * (this.getAxisPos2().x - 1) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair2.axis)} ${visibleControlledPuyo2 ? \"hidden\" : \"\"}`}></div>\n          <div style={({ top: 32 * (-1 + this.getSubDiffY(prevAction2.dir)), left: 32 * (prevAction2.x - 1 + this.getSubDiffX(prevAction2.dir)) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair2.sub)} ${(prevAction2.type === Puyotan.ActionType.PUT) && prevHistory2.remainingFrame === 1 ? \"\" : \"hidden\"}`}></div>\n          <div style={({ top: 32 * -1, left: 32 * (prevAction2.x - 1) })} className={`Game-puyo ${this.kindToClassName(this.state.activePair2.axis)} ${(prevAction2.type === Puyotan.ActionType.PUT) && prevHistory2.remainingFrame === 1 ? \"\" : \"hidden\"}`}></div>\n        </div>\n        <div className=\"Game-next Game-pos-next11\">\n          {this.nextToElements(this.state.next11)}\n        </div>\n        <div className=\"Game-next Game-pos-next12\">\n          {this.nextToElements(this.state.next12)}\n        </div>\n        <div className=\"Game-next Game-pos-next21\">\n          {this.nextToElements(this.state.next21)}\n        </div>\n        <div className=\"Game-next Game-pos-next22\">\n          {this.nextToElements(this.state.next22)}\n        </div>\n        <input type=\"button\" value={this.state.isControlledPlayer1 ? `[1P] 離席` : `[1P] 着席`} onClick={e => this.toggleControlledPlayer1()} className={`Game-button Game-size-onoff Game-pos-onoff1`} />\n        <input type=\"button\" value={this.state.isControlledPlayer2 ? `[2P] 離席` : `[2P] 着席`} onClick={e => this.toggleControlledPlayer2()} className={`Game-button Game-size-onoff Game-pos-onoff2`} />\n        <input type=\"button\" value=\"⇦\" onClick={e => this.moveLeft()} className={`Game-button Game-size-button Game-pos-leftmove`} />\n        <input type=\"button\" value=\"⇨\" onClick={e => this.moveRight()} className={`Game-button Game-size-button Game-pos-rightmove`} />\n        <input type=\"button\" value=\"L\" onClick={e => this.turnLeft()} className={`Game-button Game-size-button Game-pos-leftturn`} />\n        <input type=\"button\" value=\"R\" onClick={e => this.turnRight()} className={`Game-button Game-size-button Game-pos-rightturn`} />\n        <input type=\"button\" value=\"⇩\" onClick={e => this.putPuyo()} className={`Game-button Game-size-button2 Game-pos-put`} />\n        <input type=\"button\" value=\"Reset\" onClick={e => this.sendInit(Number(this.state.seed) + 1)} className={`Game-button Game-size-reset Game-pos-reset`} />\n        <input type=\"number\" value={this.state.displayedSeed} onChange={e => this.setState({ displayedSeed: e.target.value })} className={`Game-input-seed`} />\n        <input type=\"button\" value=\"GO\" onClick={e => this.sendInit(this.state.displayedSeed)} className={`Game-button Game-size-go Game-pos-go`} />\n      </div>\n    );\n  }\n\n  getSubDiffX(dir) {\n    switch (dir) {\n      case 0: return 0;\n      case 1: return 1;\n      case 2: return 0;\n      case 3: return -1;\n      default: throw Error(`unsupported dir ${dir}`);\n    }\n  }\n\n  getSubDiffY(dir) {\n    switch (dir) {\n      case 0: return -1;\n      case 1: return 0;\n      case 2: return 1;\n      case 3: return 0;\n      default: throw Error(`unsupported dir ${dir}`);\n    }\n  }\n\n  actionHistoriesToElements(actionHistories) {\n    let array = [];\n    for (let index = this.state.frame; index >= 1; index--) {\n      let history = actionHistories[index];\n      let text = \"\";\n      if (history != null) {\n        switch (history.action.type) {\n          case Puyotan.ActionType.PASS:\n            text = `PASS`\n            break;\n          case Puyotan.ActionType.PUT:\n            text = `PUT(${history.action.x}, ${history.action.dir})`;\n            break;\n          case Puyotan.ActionType.CHAIN:\n            text = `CHAIN`;\n            break;\n          case Puyotan.ActionType.CHAIN_FALL:\n            text = `CHAIN_FALL`;\n            break;\n          case Puyotan.ActionType.OJAMA:\n            text = `OJAMA`;\n            break;\n          default:\n            text = `unknown type`;\n            break;\n        }\n        text = `${text} ${history.remainingFrame}`;\n      }\n      const style = {\n        top: 32 * (this.state.frame - index)\n      }\n      array.push(<div key={index} style={style} className={`Game-history-tile`}>{index}:{text}</div>);\n    }\n    return array;\n  }\n\n  fieldToElements(field) {\n    return field.map((pos, kind) => {\n      const style = {\n        left: (pos.x - 1) * 32,\n        top: (13 - pos.y) * 32,\n      }\n      const className = this.kindToClassName(kind);\n      return <div key={`${pos.x}_${pos.y}`} style={style} className={`Game-puyo ${className}`}></div>;\n    });\n  }\n\n  nextToElements(pair) {\n    return [\n      <div key={'sub'} className={`Game-puyo ${this.kindToClassName(pair.sub)}`}></div>,\n      <div key={'axs'} className={`Game-puyo ${this.kindToClassName(pair.axis)}`} style={({ top: 32 })}></div>\n    ];\n  }\n\n  kindToClassName(kind) {\n    switch (kind) {\n      case Puyo.Kind.RED: return \"Game-puyo-kind-red\"\n      case Puyo.Kind.BLUE: return \"Game-puyo-kind-blue\"\n      case Puyo.Kind.GREEN: return \"Game-puyo-kind-green\"\n      case Puyo.Kind.YELLOW: return \"Game-puyo-kind-yellow\"\n      case Puyo.Kind.OJAMA: return \"Game-puyo-kind-ojama\"\n      default: return \"Game-puyo-kind-blank\"\n    }\n  }\n\n  toggleControlledPlayer1() {\n    this.setState({ isControlledPlayer1: !this.state.isControlledPlayer1 })\n  }\n\n  toggleControlledPlayer2() {\n    this.setState({ isControlledPlayer2: !this.state.isControlledPlayer2 })\n  }\n\n  reflectPuyotanView(vm) {\n    this.setState(this.puyotanViewModelToStateObject(vm));\n  }\n\n  moveLeft() {\n    if (this.state.isControlledPlayer1) if (this.state.controledPos1 > 2 || (this.state.controledPos1 === 2 && this.state.controledDir1 !== 3)) this.setState({ controledPos1: this.state.controledPos1 - 1 });\n    if (this.state.isControlledPlayer2) if (this.state.controledPos2 > 2 || (this.state.controledPos2 === 2 && this.state.controledDir2 !== 3)) this.setState({ controledPos2: this.state.controledPos2 - 1 });\n  }\n\n  moveRight() {\n    if (this.state.isControlledPlayer1) if (this.state.controledPos1 < 5 || (this.state.controledPos1 === 5 && this.state.controledDir1 !== 1)) this.setState({ controledPos1: this.state.controledPos1 + 1 });\n    if (this.state.isControlledPlayer2) if (this.state.controledPos2 < 5 || (this.state.controledPos2 === 5 && this.state.controledDir2 !== 1)) this.setState({ controledPos2: this.state.controledPos2 + 1 });\n  }\n\n  turnLeft() {\n    if (this.state.isControlledPlayer1) {\n      let adjust = 0;\n      if (this.state.controledPos1 === 1 && this.state.controledDir1 === 0) adjust = 1;\n      if (this.state.controledPos1 === 6 && this.state.controledDir1 === 2) adjust = -1;\n      this.setState({ controledDir1: (this.state.controledDir1 + 3) % 4, controledPos1: this.state.controledPos1 + adjust });\n    }\n    if (this.state.isControlledPlayer2) {\n      let adjust = 0;\n      if (this.state.controledPos2 === 1 && this.state.controledDir2 === 0) adjust = 1;\n      if (this.state.controledPos2 === 6 && this.state.controledDir2 === 2) adjust = -1;\n      this.setState({ controledDir2: (this.state.controledDir2 + 3) % 4, controledPos2: this.state.controledPos2 + adjust });\n    }\n  }\n\n  turnRight() {\n    if (this.state.isControlledPlayer1) {\n      let adjust = 0;\n      if (this.state.controledPos1 === 1 && this.state.controledDir1 === 2) adjust = 1;\n      if (this.state.controledPos1 === 6 && this.state.controledDir1 === 0) adjust = -1;\n      this.setState({ controledDir1: (this.state.controledDir1 + 1) % 4, controledPos1: this.state.controledPos1 + adjust });\n    }\n    if (this.state.isControlledPlayer2) {\n      let adjust = 0;\n      if (this.state.controledPos2 === 1 && this.state.controledDir2 === 2) adjust = 1;\n      if (this.state.controledPos2 === 6 && this.state.controledDir2 === 0) adjust = -1;\n      this.setState({ controledDir2: (this.state.controledDir2 + 1) % 4, controledPos2: this.state.controledPos2 + adjust });\n    }\n  }\n\n  putPuyo() {\n    if (this.state.isControlledPlayer1) {\n      this.sendAction(0, this.state.frame, new Puyotan.Action(Puyotan.ActionType.PUT, this.state.controledPos1, this.state.controledDir1))\n    }\n    if (this.state.isControlledPlayer2) {\n      this.sendAction(1, this.state.frame, new Puyotan.Action(Puyotan.ActionType.PUT, this.state.controledPos2, this.state.controledDir2))\n    }\n  }\n\n  pass() {\n    if (this.state.isControlledPlayer1) {\n      this.sendAction(0, this.state.frame, new Puyotan.Action(Puyotan.ActionType.PASS));\n    }\n    if (this.state.isControlledPlayer2) {\n      this.sendAction(1, this.state.frame, new Puyotan.Action(Puyotan.ActionType.PASS));\n    }\n  }\n\n  getAxisPos1() {\n    return new Puyo.Pos(this.state.controledPos1, 12);\n  }\n\n  getAxisPos2() {\n    return new Puyo.Pos(this.state.controledPos2, 12);\n  }\n\n  getSubPos1() {\n    switch (this.state.controledDir1) {\n      case 0: return new Puyo.Pos(this.state.controledPos1, 12 + 1);\n      case 1: return new Puyo.Pos(this.state.controledPos1 + 1, 12);\n      case 2: return new Puyo.Pos(this.state.controledPos1, 12 - 1);\n      case 3: return new Puyo.Pos(this.state.controledPos1 - 1, 12);\n      default: throw Error(`unsupported dir ${this.state.controledDir1}`);\n    }\n  }\n\n  getSubPos2() {\n    switch (this.state.controledDir2) {\n      case 0: return new Puyo.Pos(this.state.controledPos2, 12 + 1);\n      case 1: return new Puyo.Pos(this.state.controledPos2 + 1, 12);\n      case 2: return new Puyo.Pos(this.state.controledPos2, 12 - 1);\n      case 3: return new Puyo.Pos(this.state.controledPos2 - 1, 12);\n      default: throw Error(`unsupported dir ${this.state.controledDir2}`);\n    }\n  }\n\n  stepNextFrame() {\n    if (!this.puyotan.canStepNextFrame()) return;\n    this.puyotan.stepNextFrame();\n    let vm = this.puyotan.getViewModel();\n    this.reflectPuyotanView(vm);\n    if (vm.players[0].actionHistories[vm.frame] != null && vm.players[1].actionHistories[vm.frame] != null) {\n      this.isControllable = false;\n      setTimeout(() => { this.stepNextFrame() }, 500);\n    } else {\n      this.isControllable = true;\n      this.applyActions(500);\n    }\n  }\n\n  puyotanViewModelToStateObject(vm) {\n    return {\n      activePair1: vm.players[0].activePair,\n      activePair2: vm.players[1].activePair,\n      field1: vm.players[0].field,\n      field2: vm.players[1].field,\n      next11: vm.players[0].next1,\n      next12: vm.players[0].next2,\n      next21: vm.players[1].next1,\n      next22: vm.players[1].next2,\n      frame: vm.frame,\n      actionHistories1: vm.players[0].actionHistories,\n      actionHistories2: vm.players[1].actionHistories,\n      chain1: vm.players[0].chain,\n      chain2: vm.players[1].chain,\n      score1: vm.players[0].score,\n      score2: vm.players[1].score,\n      usedScore1: vm.players[0].usedScore,\n      usedScore2: vm.players[1].usedScore,\n      nonActiveOjama1: vm.players[0].nonActiveOjama,\n      nonActiveOjama2: vm.players[1].nonActiveOjama,\n      activeOjama1: vm.players[0].activeOjama,\n      activeOjama2: vm.players[1].activeOjama,\n      gameStatusText: vm.gameStatusText,\n    }\n  }\n\n  sendAction(id, frame, action) {\n    db.collection(`puyotan/actions/${this.state.seed}/ids/${id}`).doc(String(frame)).set({\n      type: action.type,\n      x: action.x,\n      dir: action.dir,\n    }).then(function () {\n      console.log(\"Document successfully written!\");\n    }).catch(function (error) {\n      console.error(error);\n    });\n  }\n\n  setAction(id, frame, action) {\n    console.log('setAction(id, frame, action)', id, frame, action);\n    if (this.puyotan.frame !== frame) return;\n    if (this.puyotan.setAction(id, action)) {\n      if (id === 0) {\n        this.setState({\n          controledPos1: 3,\n          controledDir1: 0,\n        });\n      } else {\n        this.setState({\n          controledPos2: 3,\n          controledDir2: 0,\n        });\n      }\n      this.stepNextFrame();\n    }\n  }\n\n  applyActions(waitMs = 0) {\n    let frame = this.state.frame;\n    let action0 = this.dbActions0[frame];\n    let action1 = this.dbActions1[frame];\n    console.log(`applyActions(frame, action0, action1)`, frame, action0, action1)\n    if (action0 != null || action1 != null) {\n      if (waitMs <= 0) {\n        if (action0 != null) this.setAction(0, frame, action0);\n        if (action1 != null) this.setAction(1, frame, action1);\n      } else {\n        this.isControllable = false;\n        setTimeout(() => {\n          if (action0 != null) this.setAction(0, frame, action0);\n          if (action1 != null) this.setAction(1, frame, action1);\n          this.isControllable = true;\n        }, waitMs);\n      }\n    }\n  }\n\n  sendInit(seed) {\n    if (seed == null) seed = Math.floor(Math.random() * Math.floor(9999));\n    db.collection(`puyotan`).doc('info').set({\n      seed: seed\n    }).then(function () {\n      console.log(\"Document successfully written!\");\n    }).catch(function (error) {\n      console.error(error);\n    });\n  }\n\n  initPuyotan(seed) {\n    console.log('initPuyotan', seed);\n    this.puyotan = new Puyotan.Puyotan(seed);\n    this.puyotan.start();\n    let vm = this.puyotan.getViewModel();\n    this.reflectPuyotanView(vm);\n    this.setState({\n      seed: seed,\n      displayedSeed: seed,\n      controledPos1: 3,\n      controledDir1: 0,\n      controledPos2: 3,\n      controledDir2: 0,\n    })\n  }\n}","import React from 'react'\nimport './App.css';\nimport AppHeader from './AppHeader'\nimport Game from './Game'\n\nconst App = () => (\n  <div className='App'>\n    <AppHeader />\n    <Game />\n  </div>\n)\n\nexport default App;\n","import React from 'react';\nimport { render } from 'react-dom';\nimport App from './components/App';\nimport './index.css';\n\nrender(\n  <App />,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}